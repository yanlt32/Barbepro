<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BarbaPRO Duo - Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ========== RESET E CONFIGURA√á√ïES GERAIS ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* ========== HEADER ========== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255,170,0,0.1) 0%, rgba(51,102,255,0.1) 100%);
            border-radius: 20px;
            border: 1px solid rgba(255,170,0,0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 40px;
            background: linear-gradient(135deg, #ffaa00, #ff7733);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        .logo h1 {
            background: linear-gradient(135deg, #ffaa00, #ff7733);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 28px;
            font-weight: 800;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            color: #aaa;
            font-size: 14px;
            margin-top: 4px;
            font-weight: 400;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* ========== BOT√ïES ========== */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::after {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ffaa00 0%, #ff7733 100%);
            color: #000;
            box-shadow: 0 6px 20px rgba(255,170,0,0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
        }
        
        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(37,211,102,0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00cc99 0%, #009973 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(0,204,153,0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff3366 0%, #cc0033 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(255,51,102,0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        /* ========== DASHBOARD GRID ========== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* ========== CARDS ========== */
        .card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ffaa00, #ff7733);
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            border-color: rgba(255,170,0,0.3);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .card-title {
            color: #ffaa00;
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ========== ESTAT√çSTICAS ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            background: rgba(255,255,255,0.05);
            transform: translateY(-3px);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffaa00, #ff7733);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            font-size: 13px;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .stat-secondary .stat-value {
            background: linear-gradient(135deg, #25D366, #128C7E);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-warning .stat-value {
            background: linear-gradient(135deg, #FF9500, #FF7733);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-danger .stat-value {
            background: linear-gradient(135deg, #ff3366, #cc0033);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* ========== TABELAS ========== */
        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 15px;
            overflow: hidden;
            background: rgba(255,255,255,0.03);
        }
        
        th {
            background: linear-gradient(135deg, rgba(255,170,0,0.1), rgba(255,170,0,0.05));
            padding: 18px 15px;
            text-align: left;
            font-weight: 700;
            color: #ffaa00;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid rgba(255,170,0,0.2);
        }
        
        td {
            padding: 16px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 14px;
        }
        
        tr:hover {
            background: rgba(255,255,255,0.03);
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        /* ========== BOT√ÉO DE EXCLUS√ÉO NA TABELA ========== */
        .delete-service-btn {
            background: rgba(255, 50, 50, 0.2);
            color: #ff3366;
            border: 1px solid rgba(255, 50, 50, 0.3);
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: bold;
            font-size: 20px;
            margin-left: 5px;
        }
        
        .delete-service-btn:hover {
            background: rgba(255, 50, 50, 0.3);
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 5px 15px rgba(255,50,50,0.3);
        }
        
        /* ========== STATUS TAGS ========== */
        .status-tag {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pago {
            background: linear-gradient(135deg, rgba(37,211,102,0.2), rgba(37,211,102,0.1));
            color: #25D366;
            border: 1px solid rgba(37,211,102,0.3);
        }
        
        .status-pendente {
            background: linear-gradient(135deg, rgba(255,149,0,0.2), rgba(255,149,0,0.1));
            color: #FF9500;
            border: 1px solid rgba(255,149,0,0.3);
        }
        
        .status-vencido {
            background: linear-gradient(135deg, rgba(255,51,102,0.2), rgba(255,51,102,0.1));
            color: #ff3366;
            border: 1px solid rgba(255,51,102,0.3);
            animation: pulse 2s infinite;
        }
        
        /* ========== MENSALISTAS ========== */
        .mensalista-card {
            background: linear-gradient(135deg, rgba(0,204,153,0.05), rgba(0,204,153,0.02));
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(0,204,153,0.1);
            border-left: 4px solid #00cc99;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .mensalista-card.vencido {
            background: linear-gradient(135deg, rgba(255,51,102,0.05), rgba(255,51,102,0.02));
            border-left: 4px solid #ff3366;
            animation: pulse-alert 2s infinite;
        }
        
        .mensalista-card.pendente {
            background: linear-gradient(135deg, rgba(255,149,0,0.05), rgba(255,149,0,0.02));
            border-left: 4px solid #FF9500;
        }
        
        .mensalista-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,204,153,0.1);
        }
        
        .mensalista-card.vencido:hover {
            box-shadow: 0 10px 25px rgba(255,51,102,0.1);
        }
        
        .mensalista-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .mensalista-nome {
            font-weight: 700;
            font-size: 16px;
            color: #fff;
        }
        
        .mensalista-actions {
            display: flex;
            gap: 8px;
        }
        
        .mensalista-detalhes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .mensalista-detalhes-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .mensalista-detalhes-label {
            color: #aaa;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .mensalista-detalhes-value {
            color: #fff;
            font-weight: 600;
        }
        
        .mensalista-valor {
            color: #00cc99;
            font-weight: 700;
            font-size: 18px;
        }
        
        .mensalista-telefone {
            color: #25D366;
            font-weight: 600;
        }
        
        .mensalista-vencimento {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .mensalista-vencimento.hoje {
            background: rgba(255,149,0,0.2);
            color: #FF9500;
            border: 1px solid rgba(255,149,0,0.3);
        }
        
        .mensalista-vencimento.vencido {
            background: rgba(255,51,102,0.2);
            color: #ff3366;
            border: 1px solid rgba(255,51,102,0.3);
            animation: pulse 2s infinite;
        }
        
        .mensalista-vencimento.proximo {
            background: rgba(255,170,0,0.2);
            color: #ffaa00;
            border: 1px solid rgba(255,170,0,0.3);
        }
        
        /* ========== DESPESAS ========== */
        .despesa-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #ff3366;
            transition: all 0.3s ease;
        }
        
        .despesa-card:hover {
            background: rgba(255,255,255,0.08);
            transform: translateY(-2px);
        }
        
        .despesa-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .despesa-categoria {
            background: rgba(255, 51, 102, 0.2);
            color: #ff99bb;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .despesa-valor {
            font-size: 24px;
            font-weight: 700;
            color: #ff3366;
            text-align: right;
        }
        
        .despesa-detalhes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 13px;
            color: #aaa;
        }
        
        .despesa-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            justify-content: flex-end;
        }
        
        .categoria-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .categoria-total {
            font-weight: 700;
            color: #ff3366;
        }
        
        .progresso-despesa {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progresso-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff3366, #ff6699);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        /* ========== FILTROS ========== */
        .filtro-container {
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .filtro-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .input-group label {
            font-size: 14px;
            color: #ffaa00;
            font-weight: 600;
        }
        
        /* ========== INPUTS ========== */
        input, select, textarea {
            padding: 14px;
            border: 1px solid rgba(255,255,255,0.15);
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        select option {
            background-color: #0a0a0a;
            color: #fff;
            padding: 12px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ffaa00;
            box-shadow: 0 0 0 3px rgba(255,170,0,0.1);
        }
        
        /* ========== MODAIS ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(26,26,46,0.95) 0%, rgba(22,33,62,0.95) 100%);
            border-radius: 25px;
            padding: 35px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255,170,0,0.3);
            box-shadow: 0 30px 60px rgba(0,0,0,0.6);
            position: relative;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255,170,0,0.3);
        }
        
        .modal-title {
            color: #ffaa00;
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #ffaa00, #ff7733);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .close-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255,170,0,0.2);
            transform: rotate(90deg);
        }
        
        /* ========== FORMUL√ÅRIOS ========== */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .form-group label {
            color: #ffaa00;
            font-weight: 700;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        /* ========== GR√ÅFICOS ========== */
        .grafico-container {
            height: 320px;
            margin-top: 20px;
            position: relative;
        }
        
        /* ========== NOTIFICA√á√ïES ========== */
        .notificacao {
            background: linear-gradient(135deg, rgba(255,51,102,0.1), rgba(255,51,102,0.05));
            border: 2px solid rgba(255,51,102,0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            animation: pulse-alert 2s infinite;
        }
        
        .notificacao.sucesso {
            background: linear-gradient(135deg, rgba(37,211,102,0.1), rgba(37,211,102,0.05));
            border: 2px solid rgba(37,211,102,0.3);
            animation: none;
        }
        
        .notificacao-titulo {
            color: #ff3366;
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notificacao.sucesso .notificacao-titulo {
            color: #25D366;
        }
        
        .notificacao-mensalista {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255,51,102,0.1);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        
        .notificacao-mensalista:hover {
            background: rgba(255,51,102,0.15);
        }
        
        /* ========== BOT√ïES DE A√á√ÉO ========== */
        .action-btn {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: bold;
            font-size: 16px;
        }
        
        .action-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }
        
        .action-btn.success {
            background: rgba(0, 204, 153, 0.2);
            color: #00cc99;
            border-color: rgba(0, 204, 153, 0.3);
        }
        
        .action-btn.success:hover {
            background: rgba(0, 204, 153, 0.3);
            box-shadow: 0 5px 15px rgba(0,204,153,0.3);
        }
        
        .action-btn.whatsapp {
            background: rgba(37, 211, 102, 0.2);
            color: #25D366;
            border-color: rgba(37, 211, 102, 0.3);
        }
        
        .action-btn.whatsapp:hover {
            background: rgba(37, 211, 102, 0.3);
            box-shadow: 0 5px 15px rgba(37,211,102,0.3);
        }
        
        .action-btn.edit {
            background: rgba(255, 170, 0, 0.2);
            color: #ffaa00;
            border-color: rgba(255, 170, 0, 0.3);
        }
        
        .action-btn.edit:hover {
            background: rgba(255, 170, 0, 0.3);
            box-shadow: 0 5px 15px rgba(255,170,0,0.3);
        }
        
        /* ========== BADGES ========== */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .badge-success {
            background: linear-gradient(135deg, rgba(37,211,102,0.2), rgba(37,211,102,0.1));
            color: #25D366;
            border: 1px solid rgba(37,211,102,0.3);
        }
        
        .badge-warning {
            background: linear-gradient(135deg, rgba(255,149,0,0.2), rgba(255,149,0,0.1));
            color: #FF9500;
            border: 1px solid rgba(255,149,0,0.3);
        }
        
        .badge-danger {
            background: linear-gradient(135deg, rgba(255,51,102,0.2), rgba(255,51,102,0.1));
            color: #ff3366;
            border: 1px solid rgba(255,51,102,0.3);
        }
        
        /* ========== ANIMA√á√ïES ========== */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }
        
        @keyframes pulse-alert {
            0% { box-shadow: 0 0 0 0 rgba(255, 51, 102, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 51, 102, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 51, 102, 0); }
        }
        
        /* ========== RESPONSIVIDADE PARA TABLET ========== */
        @media (max-width: 1024px) {
            .container {
                padding: 15px;
            }
            
            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 15px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .status-menu {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 10px;
            }
            
            .mensalista-detalhes {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filtro-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .mensalista-detalhes {
                grid-template-columns: 1fr;
            }
            
            .filtro-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 12px 20px;
            }
            
            .modal-content {
                padding: 25px 20px;
            }
            
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions .btn {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px 15px;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            .stat-value {
                font-size: 28px;
            }
            
            .mensalista-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .mensalista-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .action-btn {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            
            .delete-service-btn {
                width: 30px;
                height: 30px;
                font-size: 18px;
            }
        }
        
        /* ========== MENU DE STATUS ========== */
        .status-menu {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .status-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            color: #aaa;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
        }
        
        .status-btn.active {
            background: rgba(255,170,0,0.2);
            color: #ffaa00;
        }
        
        .status-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* ========== CONTADOR DE STATUS ========== */
        .status-counter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: rgba(255,170,0,0.3);
            border-radius: 50%;
            font-size: 12px;
            font-weight: 700;
            margin-left: 8px;
        }
        
        /* ========== CARDS RESUMO STATUS ========== */
        .status-resumo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status-card {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .status-card.pago {
            border-top: 4px solid #25D366;
        }
        
        .status-card.pendente {
            border-top: 4px solid #FF9500;
        }
        
        .status-card.vencido {
            border-top: 4px solid #ff3366;
        }
        
        .status-card-total {
            font-size: 28px;
            font-weight: 800;
            margin: 10px 0;
        }
        
        .status-card.pago .status-card-total {
            color: #25D366;
        }
        
        .status-card.pendente .status-card-total {
            color: #FF9500;
        }
        
        .status-card.vencido .status-card-total {
            color: #ff3366;
        }
        
        .status-card-label {
            font-size: 12px;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* ========== EMPTY STATE ========== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        
        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state-title {
            color: #666;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .empty-state-subtitle {
            color: #888;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        /* ========== NOTIFICA√á√ÉO PUSH ========== */
        .push-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(255,51,102,0.9), rgba(204,0,51,0.9));
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10001;
            max-width: 350px;
            animation: slideInRight 0.5s ease;
            display: none;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .push-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .push-title {
            font-weight: 700;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .push-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ========== SCROLLBAR PERSONALIZADA ========== */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ffaa00, #ff7733);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #ff7733, #ffaa00);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Moderno -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">üíà</div>
                <div>
                    <h1>BarbaPRO Duo</h1>
                    <div class="logo-subtitle">Dashboard Profissional</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" id="btnVoltarRegistro">
                    ‚Üê Voltar ao Registro
                </button>
                <button class="btn btn-whatsapp" id="btnEnviarResumo">
                    üì± Resumo WhatsApp
                </button>
                <button class="btn btn-secondary" id="btnConfiguracoes">
                    ‚öôÔ∏è Configura√ß√µes
                </button>
            </div>
        </header>

        <!-- Notifica√ß√£o Push -->
        <div class="push-notification" id="pushNotification">
            <div class="push-header">
                <div class="push-title" id="pushNotificationTitle">‚ö†Ô∏è ALERTA DE VENCIMENTO</div>
                <button class="push-close" onclick="fecharNotificacao()">√ó</button>
            </div>
            <div id="pushNotificationMessage">Mensalistas vencidos detectados!</div>
        </div>

        <!-- Alertas Sonoros (simulado) -->
        <audio id="alertSound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" preload="auto"></audio>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Card: Estat√≠sticas Gabriel -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üë®‚Äçü¶± GABRIEL</div>
                    <div class="badge badge-success">HOJE</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="gabrielHoje">0</div>
                        <div class="stat-label">Servi√ßos Hoje</div>
                    </div>
                    <div class="stat-item stat-secondary">
                        <div class="stat-value" id="gabrielTotalHoje">R$ 0</div>
                        <div class="stat-label">Total Hoje</div>
                    </div>
                    <div class="stat-item stat-warning">
                        <div class="stat-value" id="gabrielFiadoHoje">R$ 0</div>
                        <div class="stat-label">Fiado Hoje</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="gabrielMedia">R$ 0</div>
                        <div class="stat-label">M√©dia/Servi√ßo</div>
                    </div>
                </div>
            </div>

            <!-- Card: Estat√≠sticas Wagner -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üë®‚Äçü¶± WAGNER</div>
                    <div class="badge badge-success">HOJE</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="wagnerHoje">0</div>
                        <div class="stat-label">Servi√ßos Hoje</div>
                    </div>
                    <div class="stat-item stat-secondary">
                        <div class="stat-value" id="wagnerTotalHoje">R$ 0</div>
                        <div class="stat-label">Total Hoje</div>
                    </div>
                    <div class="stat-item stat-warning">
                        <div class="stat-value" id="wagnerFiadoHoje">R$ 0</div>
                        <div class="stat-label">Fiado Hoje</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="wagnerMedia">R$ 0</div>
                        <div class="stat-label">M√©dia/Servi√ßo</div>
                    </div>
                </div>
            </div>

            <!-- Card: Estat√≠sticas Gerais -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üìä ESTAT√çSTICAS GERAIS</div>
                    <div class="badge badge-warning">M√äS ATUAL</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalMes">R$ 0</div>
                        <div class="stat-label">Total M√™s</div>
                    </div>
                    <div class="stat-item stat-secondary">
                        <div class="stat-value" id="servicosMes">0</div>
                        <div class="stat-label">Servi√ßos M√™s</div>
                    </div>
                    <div class="stat-item stat-warning">
                        <div class="stat-value" id="fiadoMes">R$ 0</div>
                        <div class="stat-label">Fiado Total</div>
                    </div>
                    <div class="stat-item stat-danger">
                        <div class="stat-value" id="despesasMes">R$ 0</div>
                        <div class="stat-label">Despesas M√™s</div>
                    </div>
                </div>
            </div>

            <!-- Card: Controle de Despesas -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üí∏ CONTROLE DE DESPESAS</div>
                    <div class="badge badge-danger">M√äS ATUAL</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item" onclick="abrirModalDespesas()">
                        <div class="stat-value" id="totalDespesasMes">R$ 0</div>
                        <div class="stat-label">Total Despesas</div>
                    </div>
                    <div class="stat-item stat-secondary">
                        <div class="stat-value" id="numDespesasMes">0</div>
                        <div class="stat-label">Qtd Despesas</div>
                    </div>
                    <div class="stat-item stat-warning">
                        <div class="stat-value" id="maiorDespesaMes">R$ 0</div>
                        <div class="stat-label">Maior Despesa</div>
                    </div>
                    <div class="stat-item" onclick="abrirModalDespesas()">
                        <div class="stat-value" id="lucroLiquido">R$ 0</div>
                        <div class="stat-label">Lucro L√≠quido</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn btn-danger" id="btnNovaDespesa" style="width: 100%;">
                        + Nova Despesa
                    </button>
                </div>
            </div>
        </div>

        <!-- Segunda Linha: Pagamentos e M√©todos -->
        <div class="dashboard-grid">
            <!-- Card: Resumo Pagamentos Hoje -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üí∞ PAGAMENTOS - HOJE</div>
                    <div class="badge badge-success">RESUMO</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item" onclick="filtrarPorMetodo('dinheiro')">
                        <div class="stat-value" id="totalDinheiro">R$ 0</div>
                        <div class="stat-label">üíµ DINHEIRO</div>
                    </div>
                    <div class="stat-item" onclick="filtrarPorMetodo('pix')">
                        <div class="stat-value" id="totalPix">R$ 0</div>
                        <div class="stat-label">üì± PIX</div>
                    </div>
                    <div class="stat-item" onclick="filtrarPorMetodo('debito')">
                        <div class="stat-value" id="totalDebito">R$ 0</div>
                        <div class="stat-label">üí≥ D√âBITO</div>
                    </div>
                    <div class="stat-item" onclick="filtrarPorMetodo('credito')">
                        <div class="stat-value" id="totalCredito">R$ 0</div>
                        <div class="stat-label">üí≥ CR√âDITO</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn btn-whatsapp" id="btnEnviarPagamentos" style="width: 100%;">
                        üì± Enviar Relat√≥rio
                    </button>
                </div>
            </div>

            <!-- Card: Gr√°fico Distribui√ß√£o -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üìà DISTRIBUI√á√ÉO - HOJE</div>
                    <div class="badge badge-warning">GR√ÅFICO</div>
                </div>
                <div class="grafico-container">
                    <canvas id="graficoPizza"></canvas>
                </div>
            </div>

            <!-- Card: A√ß√µes R√°pidas -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">‚ö° A√á√ïES R√ÅPIDAS</div>
                    <div class="badge badge-success">MENU</div>
                </div>
                <div style="display: grid; gap: 15px; padding: 10px;">
                    <button class="btn btn-primary" id="btnVerResumoCompleto">
                        üìä Ver Resumo Completo
                    </button>
                    <button class="btn btn-success" id="btnRelatorioDetalhado">
                        üìÑ Relat√≥rio Detalhado
                    </button>
                    <button class="btn btn-whatsapp" id="btnEnviarMensalistas">
                        üë• Enviar Lembretes
                    </button>
                    <button class="btn btn-danger" id="btnGerenciarDespesas">
                        üí∏ Gerenciar Despesas
                    </button>
                </div>
            </div>
        </div>

        <!-- Terceira Linha: Mensalistas -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">üë• MENSALISTAS - GERENCIAMENTO INTELIGENTE</div>
                <div>
                    <button class="btn btn-success" id="btnNovoMensalista" style="margin-right: 10px;">
                        + Novo Mensalista
                    </button>
                    <button class="btn btn-whatsapp" id="btnNotificarTodos" onclick="notificarTodosMensalistas()">
                        üîî Notificar Todos
                    </button>
                </div>
            </div>
            
            <!-- Resumo de Status -->
            <div class="status-resumo" id="resumoStatusMensalistas">
                <!-- Din√¢mico -->
            </div>
            
            <!-- Filtros R√°pidos -->
            <div class="status-menu">
                <button class="status-btn active" onclick="filtrarMensalistasPorStatus('todos')">
                    üìã Todos
                    <span class="status-counter" id="counterTodos">0</span>
                </button>
                <button class="status-btn" onclick="filtrarMensalistasPorStatus('pago')">
                    ‚úÖ Pagos
                    <span class="status-counter" id="counterPagos">0</span>
                </button>
                <button class="status-btn" onclick="filtrarMensalistasPorStatus('pendente')">
                    ‚è≥ Pendentes
                    <span class="status-counter" id="counterPendentes">0</span>
                </button>
                <button class="status-btn" onclick="filtrarMensalistasPorStatus('vencido')">
                    ‚ö†Ô∏è Vencidos
                    <span class="status-counter" id="counterVencidos">0</span>
                </button>
                <button class="status-btn" onclick="filtrarMensalistasPorStatus('hoje')">
                    üìÖ Vence Hoje
                    <span class="status-counter" id="counterHoje">0</span>
                </button>
            </div>
            
            <!-- Filtros Avan√ßados -->
            <div class="filtro-container">
                <div class="filtro-grid">
                    <div class="input-group">
                        <label>üìÖ Data In√≠cio</label>
                        <input type="date" id="dataInicioMensalistas">
                    </div>
                    <div class="input-group">
                        <label>üìÖ Data Fim</label>
                        <input type="date" id="dataFimMensalistas">
                    </div>
                    <div class="input-group">
                        <label>üìä Status</label>
                        <select id="filtroStatusMensalistas">
                            <option value="todos">üìã Todos os Status</option>
                            <option value="pago">‚úÖ Pagos</option>
                            <option value="pendente">‚è≥ Pendentes</option>
                            <option value="vencido">‚ö†Ô∏è Vencidos</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>üë§ Barbeiro</label>
                        <select id="filtroBarbeiroMensalistas">
                            <option value="todos">üë• Todos Barbeiros</option>
                            <option value="Gabriel">üë®‚Äçü¶± Gabriel</option>
                            <option value="Wagner">üë®‚Äçü¶± Wagner</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: flex-end; gap: 10px;">
                        <button class="btn btn-primary" id="btnFiltrarMensalistas" style="flex: 1;">
                            üîç Aplicar Filtros
                        </button>
                        <button class="btn btn-secondary" id="btnLimparFiltros" style="flex: 1;">
                            üóëÔ∏è Limpar Filtros
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Alertas de Vencimento -->
            <div id="alertasVencimento">
                <!-- Din√¢mico -->
            </div>
            
            <!-- Lista de Mensalistas -->
            <div id="listaMensalistasDashboard">
                <!-- Conte√∫do din√¢mico -->
            </div>
        </div>

        <!-- Quarta Linha: Despesas Recentes -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">üí∏ DESPESAS RECENTES</div>
                <button class="btn btn-secondary" id="btnExportarDespesas">
                    üì§ Exportar Dados
                </button>
            </div>
            
            <!-- Filtros Despesas -->
            <div class="filtro-container">
                <div class="filtro-grid">
                    <div class="input-group">
                        <label>üìÖ Data In√≠cio</label>
                        <input type="date" id="dataInicioDespesas">
                    </div>
                    <div class="input-group">
                        <label>üìÖ Data Fim</label>
                        <input type="date" id="dataFimDespesas">
                    </div>
                    <div class="input-group">
                        <label>üìä Categoria</label>
                        <select id="filtroCategoriaDespesas">
                            <option value="todos">üìã Todas Categorias</option>
                            <option value="Suprimentos">üõí Suprimentos</option>
                            <option value="Aluguel">üè¢ Aluguel</option>
                            <option value="Energia">üí° Energia</option>
                            <option value="√Ågua">üö∞ √Ågua</option>
                            <option value="Internet">üåê Internet</option>
                            <option value="Manuten√ß√£o">üîß Manuten√ß√£o</option>
                            <option value="Outros">üì¶ Outros</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: flex-end; gap: 10px;">
                        <button class="btn btn-primary" id="btnFiltrarDespesas" style="flex: 1;">
                            üîç Filtrar Despesas
                        </button>
                        <button class="btn btn-danger" id="btnNovaDespesaRapida" style="flex: 1;">
                            + Nova Despesa
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Lista de Despesas -->
            <div id="listaDespesasRecentes">
                <!-- Conte√∫do din√¢mico -->
            </div>
        </div>

        <!-- Quinta Linha: Servi√ßos Recentes (COM BOT√ÉO DE EXCLUS√ÉO) -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">üìù SERVI√áOS RECENTES</div>
                <button class="btn btn-secondary" id="btnExportarServicos">
                    üì§ Exportar Dados
                </button>
            </div>
            
            <!-- Filtros Servi√ßos -->
            <div class="filtro-container">
                <div class="filtro-grid">
                    <div class="input-group">
                        <label>üìÖ Data In√≠cio</label>
                        <input type="date" id="dataInicioServicos">
                    </div>
                    <div class="input-group">
                        <label>üìÖ Data Fim</label>
                        <input type="date" id="dataFimServicos">
                    </div>
                    <div class="input-group">
                        <label>üë§ Barbeiro</label>
                        <select id="filtroBarbeiroServicos">
                            <option value="todos">üë• Todos Barbeiros</option>
                            <option value="Gabriel">üë®‚Äçü¶± Gabriel</option>
                            <option value="Wagner">üë®‚Äçü¶± Wagner</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>üí∞ Status Pagamento</label>
                        <select id="filtroPagamentoServicos">
                            <option value="todos">üìã Todos</option>
                            <option value="pago">‚úÖ Pagos</option>
                            <option value="fiado">‚è≥ Fiados</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: flex-end; gap: 10px;">
                        <button class="btn btn-primary" id="btnFiltrarServicos" style="flex: 1;">
                            üîç Filtrar Servi√ßos
                        </button>
                        <button class="btn btn-whatsapp" id="btnEnviarRelatorioServicos" style="flex: 1;">
                            üì± Enviar Relat√≥rio
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Tabela de Servi√ßos -->
            <div class="table-container">
                <div id="listaServicosRecentes">
                    <!-- Conte√∫do din√¢mico -->
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MODAIS ========== -->

    <!-- Modal: Resumo Completo -->
    <div class="modal" id="modalResumo">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìä RESUMO COMPLETO - BARBEIROS</h2>
                <button class="close-btn" data-modal="modalResumo">&times;</button>
            </div>
            <div id="conteudoResumo">
                <!-- Din√¢mico -->
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" data-modal="modalResumo">
                    Fechar
                </button>
                <button class="btn btn-whatsapp" id="btnEnviarResumoCompleto">
                    üì± Enviar por WhatsApp
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Relat√≥rio Pagamentos -->
    <div class="modal" id="modalPagamentos">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üí∞ RELAT√ìRIO DE PAGAMENTOS DETALHADO</h2>
                <button class="close-btn" data-modal="modalPagamentos">&times;</button>
            </div>
            <div class="filtro-container">
                <div class="filtro-grid">
                    <div class="input-group">
                        <label>üìÖ Data In√≠cio</label>
                        <input type="date" id="dataInicioPagamentos">
                    </div>
                    <div class="input-group">
                        <label>üìÖ Data Fim</label>
                        <input type="date" id="dataFimPagamentos">
                    </div>
                    <div class="input-group">
                        <label>üë§ Barbeiro</label>
                        <select id="filtroBarbeiroPagamentos">
                            <option value="todos">üë• Todos Barbeiros</option>
                            <option value="Gabriel">üë®‚Äçü¶± Gabriel</option>
                            <option value="Wagner">üë®‚Äçü¶± Wagner</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: flex-end; gap: 10px;">
                        <button class="btn btn-primary" id="btnGerarRelatorio" style="flex: 1;">
                            üìà Gerar Relat√≥rio
                        </button>
                        <button class="btn btn-whatsapp" id="btnEnviarRelatorioWhatsApp" style="flex: 1;">
                            üì± Enviar WhatsApp
                        </button>
                    </div>
                </div>
            </div>
            <div id="relatorioPagamentosDetalhado">
                <!-- Conte√∫do din√¢mico -->
            </div>
        </div>
    </div>

    <!-- Modal: Mensalistas Detalhado -->
    <div class="modal" id="modalMensalistas">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üë• GERENCIAMENTO DE MENSALISTAS</h2>
                <button class="close-btn" data-modal="modalMensalistas">&times;</button>
            </div>
            
            <!-- Formul√°rio Novo Mensalista -->
            <div class="card" style="margin-bottom: 25px;">
                <div class="card-header">
                    <div class="card-title">‚ûï NOVO MENSALISTA</div>
                    <div class="badge badge-success">CADASTRO</div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>üë§ Nome do Cliente *</label>
                        <input type="text" id="nomeMensalista" placeholder="Nome completo do cliente">
                    </div>
                    <div class="form-group">
                        <label>üì± Telefone (WhatsApp)</label>
                        <input type="tel" id="telefoneMensalista" placeholder="(11) 99999-9999" maxlength="15">
                    </div>
                    <div class="form-group">
                        <label>üë®‚Äçü¶± Barbeiro *</label>
                        <select id="barbeiroMensalista">
                            <option value="Gabriel">Gabriel</option>
                            <option value="Wagner">Wagner</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üí∞ Valor Mensal (R$) *</label>
                        <input type="number" step="0.01" id="valorMensalista" placeholder="120.00">
                    </div>
                    <div class="form-group">
                        <label>üìÖ Data de In√≠cio *</label>
                        <input type="date" id="dataInicioMensalista">
                    </div>
                    <div class="form-group">
                        <label>üìÖ Dia de Vencimento (1-31) *</label>
                        <input type="number" min="1" max="31" id="diaVencimentoMensalista" placeholder="10">
                    </div>
                    <div class="form-group">
                        <label>üìä Status *</label>
                        <select id="statusMensalista">
                            <option value="pago">‚úÖ Pago</option>
                            <option value="pendente">‚è≥ Pendente</option>
                            <option value="vencido">‚ö†Ô∏è Vencido</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üìù Observa√ß√µes</label>
                        <textarea id="observacoesMensalista" rows="2" placeholder="Observa√ß√µes importantes..."></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" id="btnLimparFormMensalista">
                        Limpar Formul√°rio
                    </button>
                    <button class="btn btn-success" id="btnAdicionarMensalista">
                        ‚úÖ Cadastrar Mensalista
                    </button>
                </div>
            </div>
            
            <!-- Lista de Mensalistas -->
            <div id="listaMensalistasModal">
                <!-- Din√¢mico -->
            </div>
        </div>
    </div>

    <!-- Modal: Gerenciamento de Despesas -->
    <div class="modal" id="modalDespesas">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üí∏ GERENCIAMENTO DE DESPESAS</h2>
                <button class="close-btn" data-modal="modalDespesas">&times;</button>
            </div>
            
            <!-- Formul√°rio Nova Despesa -->
            <div class="card" style="margin-bottom: 25px;">
                <div class="card-header">
                    <div class="card-title">‚ûï NOVA DESPESA</div>
                    <div class="badge badge-danger">REGISTRO</div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>üìù Descri√ß√£o *</label>
                        <input type="text" id="descricaoDespesa" placeholder="Ex: Compra de produtos, Pagamento de conta...">
                    </div>
                    <div class="form-group">
                        <label>üìä Categoria *</label>
                        <select id="categoriaDespesa">
                            <option value="Suprimentos">üõí Suprimentos</option>
                            <option value="Aluguel">üè¢ Aluguel</option>
                            <option value="Energia">üí° Energia</option>
                            <option value="√Ågua">üö∞ √Ågua</option>
                            <option value="Internet">üåê Internet</option>
                            <option value="Manuten√ß√£o">üîß Manuten√ß√£o</option>
                            <option value="Sal√°rios">üíº Sal√°rios</option>
                            <option value="Marketing">üì¢ Marketing</option>
                            <option value="Outros">üì¶ Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üí∞ Valor (R$) *</label>
                        <input type="number" step="0.01" id="valorDespesa" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>üìÖ Data *</label>
                        <input type="date" id="dataDespesa">
                    </div>
                    <div class="form-group">
                        <label>üè∑Ô∏è Tags (separadas por v√≠rgula)</label>
                        <input type="text" id="tagsDespesa" placeholder="urgente, mensal, vari√°vel">
                    </div>
                    <div class="form-group">
                        <label>üßæ Comprovante (opcional)</label>
                        <input type="text" id="comprovanteDespesa" placeholder="N√∫mero ou descri√ß√£o do comprovante">
                    </div>
                    <div class="form-group">
                        <label>üìù Observa√ß√µes</label>
                        <textarea id="observacoesDespesa" rows="2" placeholder="Detalhes adicionais..."></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" id="btnLimparFormDespesa">
                        Limpar Formul√°rio
                    </button>
                    <button class="btn btn-danger" id="btnAdicionarDespesa">
                        üíæ Registrar Despesa
                    </button>
                </div>
            </div>
            
            <!-- Resumo de Despesas -->
            <div class="card" style="margin-bottom: 25px;">
                <div class="card-header">
                    <div class="card-title">üìà RESUMO FINANCEIRO</div>
                    <div class="badge badge-warning">M√äS ATUAL</div>
                </div>
                <div id="resumoFinanceiroDespesas">
                    <!-- Din√¢mico -->
                </div>
            </div>
            
            <!-- Lista de Despesas -->
            <div id="listaDespesasModal">
                <!-- Din√¢mico -->
            </div>
        </div>
    </div>

    <!-- Modal: Configura√ß√µes -->
    <div class="modal" id="modalConfig">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚öôÔ∏è CONFIGURA√á√ïES DO SISTEMA</h2>
                <button class="close-btn" data-modal="modalConfig">&times;</button>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>üì± N√∫mero WhatsApp Relat√≥rios</label>
                    <input type="tel" id="numWhats" placeholder="11974065186">
                </div>
                <div class="form-group">
                    <label>üîê Novo PIN (4 d√≠gitos)</label>
                    <input type="password" id="novoPin" maxlength="4" placeholder="****">
                </div>
                <div class="form-group">
                    <label>üí∞ Valor Corte</label>
                    <input type="number" step="0.01" id="valCorte" placeholder="Valor atual: R$ 28.00">
                </div>
                <div class="form-group">
                    <label>üí∞ Valor Barba</label>
                    <input type="number" step="0.01" id="valBarba" placeholder="Valor atual: R$ 15.00">
                </div>
                <div class="form-group">
                    <label>üí∞ Valor Combo</label>
                    <input type="number" step="0.01" id="valCombo" placeholder="Valor atual: R$ 40.00">
                </div>
                <div class="form-group">
                    <label>üí∏ Or√ßamento Mensal Despesas</label>
                    <input type="number" step="0.01" id="orcamentoDespesas" placeholder="R$ 1500.00">
                </div>
                <div class="form-group">
                    <label>üîî Notifica√ß√µes de Vencimento</label>
                    <select id="notificacoesAtivas">
                        <option value="true">‚úÖ Ativas</option>
                        <option value="false">‚ùå Desativadas</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>‚è∞ Dias antes para alerta</label>
                    <input type="number" min="1" max="7" id="diasAlerta" placeholder="3">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" data-modal="modalConfig">
                    Cancelar
                </button>
                <button class="btn btn-primary" id="btnSalvarConfiguracoes">
                    üíæ Salvar Configura√ß√µes
                </button>
            </div>
        </div>
    </div>

    <!-- ========== JAVASCRIPT ========== -->
    <script>
// ========== VARI√ÅVEIS GLOBAIS ==========
// ========== VARI√ÅVEIS GLOBAIS ==========
let dados = { 
    Gabriel: [], 
    Wagner: [],
    despesas: [],
    mensalistas: [],
    config: { 
        pin: '1234', 
        whatsapp: '11974065186', 
        corte: 28, 
        barba: 15, 
        combo: 40,
        orcamentoDespesas: 1500,
        notificacoesAtivas: true,
        diasAlerta: 3
    }
};

let graficoPizza = null;
let notificacaoAtiva = false;
let editandoMensalistaId = null;
let editandoDespesaId = null;
let filtroStatusAtual = 'todos';

// ========== INICIALIZA√á√ÉO ==========
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Dashboard inicializando...');
    carregarDadosLocalmente();
    configurarDatasDashboard();
    configurarEventListenersDashboard();
    inicializarGraficos();
    atualizarDashboardCompleto();
    iniciarVerificacoesPeriodicas();
});

// ========== CARREGAR/SALVAR DADOS LOCALMENTE ==========
function carregarDadosLocalmente() {
    try {
        const dadosSalvos = localStorage.getItem('barbapro_duo_dashboard');
        if (dadosSalvos) {
            const parsed = JSON.parse(dadosSalvos);
            if (parsed.Gabriel) dados.Gabriel = parsed.Gabriel;
            if (parsed.Wagner) dados.Wagner = parsed.Wagner;
            if (parsed.despesas) dados.despesas = parsed.despesas;
            if (parsed.mensalistas) dados.mensalistas = parsed.mensalistas;
            if (parsed.config) dados.config = { ...dados.config, ...parsed.config };
            console.log('üì¶ Dados carregados do localStorage');
        }
    } catch (e) {
        console.error('Erro ao carregar dados:', e);
    }
}

function salvarDadosLocalmente() {
    try {
        localStorage.setItem('barbapro_duo_dashboard', JSON.stringify(dados));
        console.log('üíæ Dados salvos no localStorage');
    } catch (e) {
        console.error('Erro ao salvar dados:', e);
    }
}

// ========== CONFIGURAR DATAS ==========
function configurarDatasDashboard() {
    const hoje = new Date();
    const umaSemanaAtras = new Date();
    umaSemanaAtras.setDate(hoje.getDate() - 7);
    const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
    
    const formatarData = (date) => date.toISOString().split('T')[0];
    
    const dataInicioServicos = document.getElementById('dataInicioServicos');
    const dataFimServicos = document.getElementById('dataFimServicos');
    const dataInicioDespesas = document.getElementById('dataInicioDespesas');
    const dataFimDespesas = document.getElementById('dataFimDespesas');
    const dataInicioPagamentos = document.getElementById('dataInicioPagamentos');
    const dataFimPagamentos = document.getElementById('dataFimPagamentos');
    const dataInicioMensalistas = document.getElementById('dataInicioMensalistas');
    const dataFimMensalistas = document.getElementById('dataFimMensalistas');
    const dataInicioMensalista = document.getElementById('dataInicioMensalista');
    const diaVencimentoMensalista = document.getElementById('diaVencimentoMensalista');
    const dataDespesa = document.getElementById('dataDespesa');
    
    if (dataInicioServicos) dataInicioServicos.value = formatarData(umaSemanaAtras);
    if (dataFimServicos) dataFimServicos.value = formatarData(hoje);
    if (dataInicioDespesas) dataInicioDespesas.value = formatarData(umaSemanaAtras);
    if (dataFimDespesas) dataFimDespesas.value = formatarData(hoje);
    if (dataInicioPagamentos) dataInicioPagamentos.value = formatarData(primeiroDiaMes);
    if (dataFimPagamentos) dataFimPagamentos.value = formatarData(hoje);
    if (dataInicioMensalistas) dataInicioMensalistas.value = formatarData(primeiroDiaMes);
    if (dataFimMensalistas) dataFimMensalistas.value = formatarData(hoje);
    if (dataInicioMensalista) dataInicioMensalista.value = formatarData(hoje);
    if (diaVencimentoMensalista) diaVencimentoMensalista.value = hoje.getDate();
    if (dataDespesa) dataDespesa.value = formatarData(hoje);
}

// ========== EVENT LISTENERS ==========
function configurarEventListenersDashboard() {
    // Bot√µes principais
    const btnVoltarRegistro = document.getElementById('btnVoltarRegistro');
    const btnConfiguracoes = document.getElementById('btnConfiguracoes');
    const btnEnviarResumo = document.getElementById('btnEnviarResumo');
    
    if (btnVoltarRegistro) btnVoltarRegistro.addEventListener('click', voltarParaRegistro);
    if (btnConfiguracoes) btnConfiguracoes.addEventListener('click', abrirModalConfiguracoes);
    if (btnEnviarResumo) btnEnviarResumo.addEventListener('click', () => abrirModalResumoCompleto());
    
    // A√ß√µes r√°pidas
    const btnVerResumoCompleto = document.getElementById('btnVerResumoCompleto');
    const btnRelatorioDetalhado = document.getElementById('btnRelatorioDetalhado');
    const btnEnviarMensalistas = document.getElementById('btnEnviarMensalistas');
    const btnGerenciarDespesas = document.getElementById('btnGerenciarDespesas');
    
    if (btnVerResumoCompleto) btnVerResumoCompleto.addEventListener('click', () => abrirModalResumoCompleto());
    if (btnRelatorioDetalhado) btnRelatorioDetalhado.addEventListener('click', abrirModalPagamentos);
    if (btnEnviarMensalistas) btnEnviarMensalistas.addEventListener('click', enviarLembretesMensalistas);
    if (btnGerenciarDespesas) btnGerenciarDespesas.addEventListener('click', () => abrirModalDespesas());
    
    // DESPESAS - BOT√ïES PRINCIPAIS
    const btnNovaDespesa = document.getElementById('btnNovaDespesa');
    const btnNovaDespesaRapida = document.getElementById('btnNovaDespesaRapida');
    const btnFiltrarDespesas = document.getElementById('btnFiltrarDespesas');
    const btnExportarDespesas = document.getElementById('btnExportarDespesas');
    const btnAdicionarDespesa = document.getElementById('btnAdicionarDespesa');
    const btnLimparFormDespesa = document.getElementById('btnLimparFormDespesa');
    
    if (btnNovaDespesa) btnNovaDespesa.addEventListener('click', () => abrirModalDespesas());
    if (btnNovaDespesaRapida) btnNovaDespesaRapida.addEventListener('click', () => abrirModalDespesas());
    if (btnFiltrarDespesas) btnFiltrarDespesas.addEventListener('click', atualizarListaDespesasRecentes);
    if (btnExportarDespesas) btnExportarDespesas.addEventListener('click', exportarDadosDespesas);
    if (btnAdicionarDespesa) btnAdicionarDespesa.addEventListener('click', adicionarOuAtualizarDespesa);
    if (btnLimparFormDespesa) btnLimparFormDespesa.addEventListener('click', limparFormDespesa);
    
    // Mensalistas
    const btnNovoMensalista = document.getElementById('btnNovoMensalista');
    const btnFiltrarMensalistas = document.getElementById('btnFiltrarMensalistas');
    const btnLimparFiltros = document.getElementById('btnLimparFiltros');
    const btnAdicionarMensalista = document.getElementById('btnAdicionarMensalista');
    const btnLimparFormMensalista = document.getElementById('btnLimparFormMensalista');
    
    if (btnNovoMensalista) btnNovoMensalista.addEventListener('click', abrirModalMensalistas);
    if (btnFiltrarMensalistas) btnFiltrarMensalistas.addEventListener('click', () => filtrarMensalistasPorStatus('todos', true));
    if (btnLimparFiltros) btnLimparFiltros.addEventListener('click', limparFiltrosMensalistas);
    if (btnAdicionarMensalista) btnAdicionarMensalista.addEventListener('click', adicionarOuAtualizarMensalista);
    if (btnLimparFormMensalista) btnLimparFormMensalista.addEventListener('click', limparFormMensalista);
    
    // Servi√ßos
    const btnFiltrarServicos = document.getElementById('btnFiltrarServicos');
    const btnEnviarRelatorioServicos = document.getElementById('btnEnviarRelatorioServicos');
    const btnExportarServicos = document.getElementById('btnExportarServicos');
    
    if (btnFiltrarServicos) btnFiltrarServicos.addEventListener('click', atualizarListaServicosRecentes);
    if (btnEnviarRelatorioServicos) btnEnviarRelatorioServicos.addEventListener('click', () => enviarRelatorioWhatsApp('servicos'));
    if (btnExportarServicos) btnExportarServicos.addEventListener('click', exportarDadosServicos);
    
    // Pagamentos
    const btnEnviarPagamentos = document.getElementById('btnEnviarPagamentos');
    const btnGerarRelatorio = document.getElementById('btnGerarRelatorio');
    const btnEnviarRelatorioWhatsApp = document.getElementById('btnEnviarRelatorioWhatsApp');
    const btnEnviarResumoCompleto = document.getElementById('btnEnviarResumoCompleto');
    
    if (btnEnviarPagamentos) btnEnviarPagamentos.addEventListener('click', () => abrirModalPagamentos());
    if (btnGerarRelatorio) btnGerarRelatorio.addEventListener('click', gerarRelatorioPagamentosDetalhado);
    if (btnEnviarRelatorioWhatsApp) btnEnviarRelatorioWhatsApp.addEventListener('click', () => enviarRelatorioWhatsApp('pagamentos'));
    if (btnEnviarResumoCompleto) btnEnviarResumoCompleto.addEventListener('click', () => enviarRelatorioWhatsApp('resumo'));
    
    // Configura√ß√µes
    const btnSalvarConfiguracoes = document.getElementById('btnSalvarConfiguracoes');
    if (btnSalvarConfiguracoes) btnSalvarConfiguracoes.addEventListener('click', salvarConfiguracoes);
    
    // Fechar modais
    document.querySelectorAll('.close-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const modalId = this.getAttribute('data-modal');
            fecharModal(modalId);
        });
    });
    
    // Fechar modais ao clicar fora
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === this) this.style.display = 'none';
        });
    });
}

// ========== ATUALIZAR DASHBOARD ==========
function atualizarDashboardCompleto() {
    atualizarEstatisticasBarbeiros();
    atualizarEstatisticasGerais();
    atualizarEstatisticasDespesas();
    atualizarResumoPagamentos();
    atualizarListaDespesasRecentes();
    atualizarListaServicosRecentes();
    atualizarResumoStatusMensalistas();
    filtrarMensalistasPorStatus(filtroStatusAtual);
    atualizarGraficoPizza();
    verificarVencimentosMensalistas();
    salvarDadosLocalmente();
}

function atualizarEstatisticasBarbeiros() {
    const hoje = new Date().toISOString().split('T')[0];
    
    // Wagner
    const servicosWagnerHoje = dados.Wagner ? dados.Wagner.filter(s => s.data === hoje) : [];
    const totalWagnerHoje = servicosWagnerHoje.reduce((sum, s) => sum + (s.valor || 0), 0);
    const fiadoWagnerHoje = servicosWagnerHoje.filter(s => !s.pago).reduce((sum, s) => sum + (s.valor || 0), 0);
    const mediaWagner = servicosWagnerHoje.length > 0 ? totalWagnerHoje / servicosWagnerHoje.length : 0;
    
    const wagnerHoje = document.getElementById('wagnerHoje');
    const wagnerTotalHoje = document.getElementById('wagnerTotalHoje');
    const wagnerFiadoHoje = document.getElementById('wagnerFiadoHoje');
    const wagnerMedia = document.getElementById('wagnerMedia');
    
    if (wagnerHoje) wagnerHoje.textContent = servicosWagnerHoje.length;
    if (wagnerTotalHoje) wagnerTotalHoje.textContent = `R$ ${totalWagnerHoje.toFixed(2)}`;
    if (wagnerFiadoHoje) wagnerFiadoHoje.textContent = `R$ ${fiadoWagnerHoje.toFixed(2)}`;
    if (wagnerMedia) wagnerMedia.textContent = `R$ ${mediaWagner.toFixed(2)}`;
    
    // Gabriel
    const servicosGabrielHoje = dados.Gabriel ? dados.Gabriel.filter(s => s.data === hoje) : [];
    const totalGabrielHoje = servicosGabrielHoje.reduce((sum, s) => sum + (s.valor || 0), 0);
    const fiadoGabrielHoje = servicosGabrielHoje.filter(s => !s.pago).reduce((sum, s) => sum + (s.valor || 0), 0);
    const mediaGabriel = servicosGabrielHoje.length > 0 ? totalGabrielHoje / servicosGabrielHoje.length : 0;
    
    const gabrielHoje = document.getElementById('gabrielHoje');
    const gabrielTotalHoje = document.getElementById('gabrielTotalHoje');
    const gabrielFiadoHoje = document.getElementById('gabrielFiadoHoje');
    const gabrielMedia = document.getElementById('gabrielMedia');
    
    if (gabrielHoje) gabrielHoje.textContent = servicosGabrielHoje.length;
    if (gabrielTotalHoje) gabrielTotalHoje.textContent = `R$ ${totalGabrielHoje.toFixed(2)}`;
    if (gabrielFiadoHoje) gabrielFiadoHoje.textContent = `R$ ${fiadoGabrielHoje.toFixed(2)}`;
    if (gabrielMedia) gabrielMedia.textContent = `R$ ${mediaGabriel.toFixed(2)}`;
}

function atualizarEstatisticasGerais() {
    const hoje = new Date();
    const mesAtual = hoje.getMonth();
    const anoAtual = hoje.getFullYear();
    
    const servicosWagnerMes = dados.Wagner ? dados.Wagner.filter(s => {
        if (!s.data) return false;
        const data = new Date(s.data);
        return data.getMonth() === mesAtual && data.getFullYear() === anoAtual;
    }) : [];
    
    const servicosGabrielMes = dados.Gabriel ? dados.Gabriel.filter(s => {
        if (!s.data) return false;
        const data = new Date(s.data);
        return data.getMonth() === mesAtual && data.getFullYear() === anoAtual;
    }) : [];
    
    const totalWagnerMes = servicosWagnerMes.reduce((sum, s) => sum + (s.valor || 0), 0);
    const totalGabrielMes = servicosGabrielMes.reduce((sum, s) => sum + (s.valor || 0), 0);
    const totalMes = totalWagnerMes + totalGabrielMes;
    const servicosMes = servicosWagnerMes.length + servicosGabrielMes.length;
    
    const fiadoMes = [...(dados.Wagner || []), ...(dados.Gabriel || [])]
        .filter(s => {
            if (!s.data) return false;
            const data = new Date(s.data);
            return data.getMonth() === mesAtual && data.getFullYear() === anoAtual && !s.pago;
        })
        .reduce((sum, s) => sum + (s.valor || 0), 0);
    
    const totalMesEl = document.getElementById('totalMes');
    const servicosMesEl = document.getElementById('servicosMes');
    const fiadoMesEl = document.getElementById('fiadoMes');
    
    if (totalMesEl) totalMesEl.textContent = `R$ ${totalMes.toFixed(2)}`;
    if (servicosMesEl) servicosMesEl.textContent = servicosMes;
    if (fiadoMesEl) fiadoMesEl.textContent = `R$ ${fiadoMes.toFixed(2)}`;
}

// ========== DESPESAS - FUN√á√ïES CORRIGIDAS ==========
function atualizarEstatisticasDespesas() {
    const hoje = new Date();
    const mesAtual = hoje.getMonth();
    const anoAtual = hoje.getFullYear();
    
    const despesasMes = dados.despesas ? dados.despesas.filter(d => {
        if (!d.data) return false;
        const data = new Date(d.data);
        return data.getMonth() === mesAtual && data.getFullYear() === anoAtual;
    }) : [];
    
    const totalDespesasMes = despesasMes.reduce((sum, d) => sum + (d.valor || 0), 0);
    const numDespesasMes = despesasMes.length;
    const maiorDespesaMes = despesasMes.length > 0 ? Math.max(...despesasMes.map(d => d.valor || 0)) : 0;
    
    const totalMesEl = document.getElementById('totalMes');
    const totalReceitaMes = totalMesEl ? parseFloat(totalMesEl.textContent.replace('R$ ', '')) || 0 : 0;
    const lucroLiquido = totalReceitaMes - totalDespesasMes;
    
    const totalDespesasMesEl = document.getElementById('totalDespesasMes');
    const numDespesasMesEl = document.getElementById('numDespesasMes');
    const maiorDespesaMesEl = document.getElementById('maiorDespesaMes');
    const lucroLiquidoEl = document.getElementById('lucroLiquido');
    const despesasMesEl = document.getElementById('despesasMes');
    
    if (totalDespesasMesEl) totalDespesasMesEl.textContent = `R$ ${totalDespesasMes.toFixed(2)}`;
    if (numDespesasMesEl) numDespesasMesEl.textContent = numDespesasMes;
    if (maiorDespesaMesEl) maiorDespesaMesEl.textContent = `R$ ${maiorDespesaMes.toFixed(2)}`;
    if (despesasMesEl) despesasMesEl.textContent = `R$ ${totalDespesasMes.toFixed(2)}`;
    if (lucroLiquidoEl) {
        lucroLiquidoEl.textContent = `R$ ${lucroLiquido.toFixed(2)}`;
        lucroLiquidoEl.style.color = lucroLiquido >= 0 ? '#25D366' : '#ff3366';
    }
}

function atualizarListaDespesasRecentes() {
    const dataInicio = document.getElementById('dataInicioDespesas')?.value;
    const dataFim = document.getElementById('dataFimDespesas')?.value;
    const filtroCategoria = document.getElementById('filtroCategoriaDespesas')?.value || 'todos';
    
    if (!dataInicio || !dataFim) return;
    
    let despesasFiltradas = (dados.despesas || []).filter(d => 
        d.data && d.data >= dataInicio && d.data <= dataFim &&
        (filtroCategoria === 'todos' || d.categoria === filtroCategoria)
    ).sort((a, b) => new Date(b.data) - new Date(a.data));
    
    let html = '';
    
    if (despesasFiltradas.length > 0) {
        despesasFiltradas.slice(0, 20).forEach(d => {
            html += `<div class="despesa-card" id="despesa-${d.id}">
                <div class="despesa-header">
                    <div>
                        <div style="font-weight:600; margin-bottom:5px;">${d.descricao || 'Sem descri√ß√£o'}</div>
                        <span class="despesa-categoria">${d.categoria || 'Outros'}</span>
                    </div>
                    <div class="despesa-valor">R$ ${(d.valor || 0).toFixed(2)}</div>
                </div>
                <div class="despesa-detalhes">
                    <div>üìÖ ${formatarDataBR(d.data)}</div>
                    ${d.comprovante ? `<div>üßæ ${d.comprovante}</div>` : ''}
                    ${d.tags ? `<div>üè∑Ô∏è ${Array.isArray(d.tags) ? d.tags.join(', ') : d.tags}</div>` : ''}
                </div>
                <div class="despesa-actions">
                    <button class="action-btn" onclick="removerDespesa(${d.id})" title="Remover despesa">üóëÔ∏è</button>
                </div>
            </div>`;
        });
    } else {
        html = `<div class="empty-state">
            <div class="empty-state-icon">üí∏</div>
            <div class="empty-state-title">Nenhuma despesa encontrada</div>
            <div class="empty-state-subtitle">Cadastre sua primeira despesa</div>
            <button class="btn btn-danger" onclick="abrirModalDespesas()" style="margin-top:20px;">+ Nova Despesa</button>
        </div>`;
    }
    
    const listaDespesasRecentes = document.getElementById('listaDespesasRecentes');
    if (listaDespesasRecentes) listaDespesasRecentes.innerHTML = html;
    
    // Tamb√©m atualizar a lista no modal
    atualizarListaDespesasModal();
}

function atualizarListaDespesasModal() {
    const despesasOrdenadas = (dados.despesas || []).sort((a, b) => new Date(b.data) - new Date(a.data));
    
    let html = '<h3 style="margin:20px 0 15px;">üìã Hist√≥rico de Despesas</h3>';
    
    if (despesasOrdenadas.length > 0) {
        despesasOrdenadas.forEach(d => {
            html += `<div class="despesa-card" style="margin-bottom:10px;">
                <div class="despesa-header">
                    <div>
                        <div style="font-weight:600;">${d.descricao || 'Sem descri√ß√£o'}</div>
                        <span class="despesa-categoria">${d.categoria || 'Outros'}</span>
                    </div>
                    <div class="despesa-valor">R$ ${(d.valor || 0).toFixed(2)}</div>
                </div>
                <div class="despesa-detalhes">
                    <div>üìÖ ${formatarDataBR(d.data)}</div>
                </div>
                <div class="despesa-actions">
                    <button class="action-btn" onclick="removerDespesa(${d.id})" title="Remover despesa">üóëÔ∏è</button>
                </div>
            </div>`;
        });
    } else {
        html += `<div class="empty-state">
            <div class="empty-state-icon">üí∏</div>
            <div class="empty-state-title">Nenhuma despesa cadastrada</div>
        </div>`;
    }
    
    const listaDespesasModal = document.getElementById('listaDespesasModal');
    if (listaDespesasModal) listaDespesasModal.innerHTML = html;
}

// FUN√á√ÉO CORRIGIDA PARA REMOVER DESPESA
function removerDespesa(id) {
    if (!confirm('‚ö†Ô∏è Remover esta despesa permanentemente?')) return;
    
    if (!dados.despesas) dados.despesas = [];
    
    const index = dados.despesas.findIndex(d => d.id === id);
    if (index === -1) {
        alert('‚ùå Despesa n√£o encontrada!');
        return;
    }
    
    dados.despesas.splice(index, 1);
    salvarDadosLocalmente();
    atualizarDashboardCompleto();
    atualizarListaDespesasModal();
    alert('‚úÖ Despesa removida com sucesso!');
}

function adicionarOuAtualizarDespesa() {
    const descricao = document.getElementById('descricaoDespesa')?.value?.trim();
    const categoria = document.getElementById('categoriaDespesa')?.value;
    const valor = parseFloat(document.getElementById('valorDespesa')?.value);
    const data = document.getElementById('dataDespesa')?.value;
    const tags = document.getElementById('tagsDespesa')?.value?.trim();
    const comprovante = document.getElementById('comprovanteDespesa')?.value?.trim();
    const observacoes = document.getElementById('observacoesDespesa')?.value?.trim();
    
    if (!descricao || !categoria || isNaN(valor) || !data) {
        alert('‚ùå Preencha todos os campos obrigat√≥rios!');
        return;
    }
    
    if (valor <= 0) {
        alert('‚ùå O valor deve ser maior que zero!');
        return;
    }
    
    if (!dados.despesas) dados.despesas = [];
    
    const id = dados.despesas.length > 0 ? Math.max(...dados.despesas.map(d => d.id || 0)) + 1 : 1;
    
    const novaDespesa = {
        id: id,
        data: data,
        descricao: descricao,
        categoria: categoria,
        valor: valor,
        tags: tags ? tags.split(',').map(t => t.trim()) : [],
        comprovante: comprovante || '',
        observacoes: observacoes || ''
    };
    
    dados.despesas.push(novaDespesa);
    
    salvarDadosLocalmente();
    limparFormDespesa();
    atualizarDashboardCompleto();
    fecharModal('modalDespesas');
    alert('‚úÖ Despesa registrada com sucesso!');
}

function limparFormDespesa() {
    const descricao = document.getElementById('descricaoDespesa');
    const valor = document.getElementById('valorDespesa');
    const tags = document.getElementById('tagsDespesa');
    const comprovante = document.getElementById('comprovanteDespesa');
    const observacoes = document.getElementById('observacoesDespesa');
    const categoria = document.getElementById('categoriaDespesa');
    const dataDespesa = document.getElementById('dataDespesa');
    
    if (descricao) descricao.value = '';
    if (valor) valor.value = '';
    if (tags) tags.value = '';
    if (comprovante) comprovante.value = '';
    if (observacoes) observacoes.value = '';
    if (categoria) categoria.value = 'Suprimentos';
    
    const hoje = new Date();
    if (dataDespesa) dataDespesa.value = hoje.toISOString().split('T')[0];
}

// ========== GR√ÅFICOS ==========
function inicializarGraficos() {
    const ctxPizza = document.getElementById('graficoPizza');
    if (!ctxPizza) return;
    
    graficoPizza = new Chart(ctxPizza.getContext('2d'), {
        type: 'pie',
        data: {
            labels: ['Wagner ‚≠ê', 'Gabriel', 'Fiado'],
            datasets: [{
                data: [0, 0, 0],
                backgroundColor: ['rgba(51,102,255,0.8)', 'rgba(255,170,0,0.8)', 'rgba(255,51,102,0.8)'],
                borderColor: ['rgba(51,102,255,1)', 'rgba(255,170,0,1)', 'rgba(255,51,102,1)'],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom', labels: { color: '#fff' } }
            }
        }
    });
}

function atualizarGraficoPizza() {
    if (!graficoPizza) return;
    
    const hoje = new Date().toISOString().split('T')[0];
    
    const totalWagner = dados.Wagner ? dados.Wagner.filter(s => s.data === hoje).reduce((sum, s) => sum + (s.valor || 0), 0) : 0;
    const totalGabriel = dados.Gabriel ? dados.Gabriel.filter(s => s.data === hoje).reduce((sum, s) => sum + (s.valor || 0), 0) : 0;
    const totalFiado = [...(dados.Wagner || []), ...(dados.Gabriel || [])]
        .filter(s => s.data === hoje && !s.pago)
        .reduce((sum, s) => sum + (s.valor || 0), 0);
    
    graficoPizza.data.datasets[0].data = [totalWagner, totalGabriel, totalFiado];
    graficoPizza.update();
}

function atualizarResumoPagamentos() {
    const hoje = new Date().toISOString().split('T')[0];
    const servicosHoje = [...(dados.Wagner || []), ...(dados.Gabriel || [])].filter(s => s.data === hoje);
    
    const totalDinheiro = servicosHoje.filter(s => s.metodoPagamento === 'dinheiro').reduce((sum, s) => sum + (s.valor || 0), 0);
    const totalPix = servicosHoje.filter(s => s.metodoPagamento === 'pix').reduce((sum, s) => sum + (s.valor || 0), 0);
    const totalDebito = servicosHoje.filter(s => s.metodoPagamento === 'debito').reduce((sum, s) => sum + (s.valor || 0), 0);
    const totalCredito = servicosHoje.filter(s => s.metodoPagamento === 'credito').reduce((sum, s) => sum + (s.valor || 0), 0);
    
    const totalDinheiroEl = document.getElementById('totalDinheiro');
    const totalPixEl = document.getElementById('totalPix');
    const totalDebitoEl = document.getElementById('totalDebito');
    const totalCreditoEl = document.getElementById('totalCredito');
    
    if (totalDinheiroEl) totalDinheiroEl.textContent = `R$ ${totalDinheiro.toFixed(2)}`;
    if (totalPixEl) totalPixEl.textContent = `R$ ${totalPix.toFixed(2)}`;
    if (totalDebitoEl) totalDebitoEl.textContent = `R$ ${totalDebito.toFixed(2)}`;
    if (totalCreditoEl) totalCreditoEl.textContent = `R$ ${totalCredito.toFixed(2)}`;
}

// ========== LISTA DE SERVI√áOS ==========
function atualizarListaServicosRecentes() {
    const dataInicio = document.getElementById('dataInicioServicos')?.value;
    const dataFim = document.getElementById('dataFimServicos')?.value;
    const filtroBarbeiro = document.getElementById('filtroBarbeiroServicos')?.value || 'todos';
    const filtroPagamento = document.getElementById('filtroPagamentoServicos')?.value || 'todos';
    
    if (!dataInicio || !dataFim) return;
    
    let todosServicos = [...(dados.Wagner || []), ...(dados.Gabriel || [])];
    
    todosServicos = todosServicos.filter(s => 
        s.data && s.data >= dataInicio && s.data <= dataFim &&
        (filtroBarbeiro === 'todos' || s.barbeiro === filtroBarbeiro) &&
        (filtroPagamento === 'todos' || 
         (filtroPagamento === 'pago' && s.pago) || 
         (filtroPagamento === 'fiado' && !s.pago))
    );
    
    todosServicos.sort((a, b) => {
        const dataA = new Date(a.data + 'T' + (a.hora || '00:00'));
        const dataB = new Date(b.data + 'T' + (b.hora || '00:00'));
        return dataB - dataA;
    });
    
    let html = '';
    
    if (todosServicos.length > 0) {
        html = `<table style="width:100%;"><thead><tr>
            <th>üìÖ Data</th>
            <th>‚è∞ Hora</th>
            <th>üë§ Barbeiro</th>
            <th>‚úÇÔ∏è Servi√ßo</th>
            <th>üë§ Cliente</th>
            <th>üí∞ Valor</th>
            <th>üí≥ Pagamento</th>
            <th>üìä Status</th>
            <th>üóëÔ∏è</th>
        </tr></thead><tbody>`;
        
        todosServicos.slice(0, 50).forEach(s => {
            const statusClass = s.pago ? 'status-pago' : 'status-pendente';
            const statusTexto = s.pago ? 'PAGO' : 'FIADO';
            const isPrincipal = s.barbeiro === 'Wagner';
            
            html += `<tr>
                <td>${formatarDataBR(s.data)}</td>
                <td>${s.hora || '--:--'}</td>
                <td>
                    <span style="background:${isPrincipal ? 'rgba(51,102,255,0.2)' : 'rgba(255,170,0,0.2)'}; color:${isPrincipal ? '#3366ff' : '#ffaa00'}; padding:6px 12px; border-radius:20px; font-weight:600;">
                        ${s.barbeiro || 'N/A'} ${isPrincipal ? '‚≠ê' : ''}
                    </span>
                </td>
                <td>${s.tipo || 'Corte'}</td>
                <td>${s.cliente || 'Cliente'}</td>
                <td style="font-weight:600; color:#ffaa00;">R$ ${(s.valor || 0).toFixed(2)}</td>
                <td>${obterIconeMetodo(s.metodoPagamento)}</td>
                <td><span class="status-tag ${statusClass}">${statusTexto}</span></td>
                <td><button class="delete-service-btn" onclick="excluirServico(${s.id}, '${s.barbeiro}')" title="Excluir servi√ßo">√ó</button></td>
            </tr>`;
        });
        
        html += `</tbody></table>`;
    } else {
        html = `<div class="empty-state">
            <div class="empty-state-icon">üìù</div>
            <div class="empty-state-title">Nenhum servi√ßo encontrado</div>
            <div class="empty-state-subtitle">Tente ajustar os filtros</div>
        </div>`;
    }
    
    const listaServicosRecentes = document.getElementById('listaServicosRecentes');
    if (listaServicosRecentes) listaServicosRecentes.innerHTML = html;
}

function obterIconeMetodo(metodo) {
    const icones = {
        'dinheiro': 'üíµ DINHEIRO',
        'pix': 'üì± PIX',
        'debito': 'üí≥ D√âBITO',
        'credito': 'üí≥ CR√âDITO'
    };
    return icones[metodo] || 'üí∞';
}

function excluirServico(servicoId, barbeiro) {
    if (!confirm('‚ö†Ô∏è Excluir este servi√ßo permanentemente?')) return;
    
    if (!dados[barbeiro]) {
        alert('‚ùå Barbeiro n√£o encontrado!');
        return;
    }
    
    const index = dados[barbeiro].findIndex(s => s.id === servicoId);
    if (index === -1) {
        alert('‚ùå Servi√ßo n√£o encontrado!');
        return;
    }
    
    dados[barbeiro].splice(index, 1);
    salvarDadosLocalmente();
    atualizarDashboardCompleto();
    alert('‚úÖ Servi√ßo exclu√≠do!');
}

// ========== MENSALISTAS ==========
function atualizarResumoStatusMensalistas() {
    const m = dados.mensalistas || [];
    const pagos = m.filter(m => m.status === 'pago').length;
    const pendentes = m.filter(m => m.status === 'pendente').length;
    const vencidos = m.filter(m => m.status === 'vencido').length;
    const hoje = new Date();
    hoje.setHours(0, 0, 0, 0);
    
    const vencemHoje = m.filter(m => {
        if (m.status === 'pago') return false;
        const venc = new Date(m.dataVencimento || m.vencimento);
        venc.setHours(0, 0, 0, 0);
        return venc.getTime() === hoje.getTime();
    }).length;
    
    const counterTodos = document.getElementById('counterTodos');
    const counterPagos = document.getElementById('counterPagos');
    const counterPendentes = document.getElementById('counterPendentes');
    const counterVencidos = document.getElementById('counterVencidos');
    const counterHoje = document.getElementById('counterHoje');
    const resumoStatus = document.getElementById('resumoStatusMensalistas');
    
    if (counterTodos) counterTodos.textContent = m.length;
    if (counterPagos) counterPagos.textContent = pagos;
    if (counterPendentes) counterPendentes.textContent = pendentes;
    if (counterVencidos) counterVencidos.textContent = vencidos;
    if (counterHoje) counterHoje.textContent = vencemHoje;
    
    if (resumoStatus) {
        resumoStatus.innerHTML = `
            <div class="status-card pago">
                <div class="status-card-label">‚úÖ PAGOS</div>
                <div class="status-card-total">${pagos}</div>
            </div>
            <div class="status-card pendente">
                <div class="status-card-label">‚è≥ PENDENTES</div>
                <div class="status-card-total">${pendentes}</div>
            </div>
            <div class="status-card vencido">
                <div class="status-card-label">‚ö†Ô∏è VENCIDOS</div>
                <div class="status-card-total">${vencidos}</div>
            </div>
            <div class="status-card" style="border-top:4px solid #ffaa00;">
                <div class="status-card-label">üìÖ VENCE HOJE</div>
                <div class="status-card-total" style="color:#ffaa00;">${vencemHoje}</div>
            </div>
        `;
    }
}

function filtrarMensalistasPorStatus(status) {
    filtroStatusAtual = status;
    
    let filtrados = [...(dados.mensalistas || [])];
    
    if (status === 'hoje') {
        const hoje = new Date();
        hoje.setHours(0, 0, 0, 0);
        filtrados = filtrados.filter(m => {
            if (m.status === 'pago') return false;
            const venc = new Date(m.dataVencimento || m.vencimento);
            venc.setHours(0, 0, 0, 0);
            return venc.getTime() === hoje.getTime();
        });
    } else if (status !== 'todos') {
        filtrados = filtrados.filter(m => m.status === status);
    }
    
    filtrados.sort((a, b) => {
        const ordem = { 'vencido': 1, 'pendente': 2, 'pago': 3 };
        return (ordem[a.status] || 99) - (ordem[b.status] || 99);
    });
    
    let html = '';
    
    if (filtrados.length > 0) {
        filtrados.forEach(m => {
            const statusClass = `status-${m.status}`;
            const statusTexto = m.status === 'pago' ? '‚úÖ PAGO' : m.status === 'pendente' ? '‚è≥ PENDENTE' : '‚ö†Ô∏è VENCIDO';
            const dataVenc = formatarDataBR(m.dataVencimento || m.vencimento);
            const isPrincipal = m.barbeiro === 'Wagner';
            
            html += `<div class="mensalista-card ${m.status === 'vencido' ? 'vencido' : ''}">
                <div class="mensalista-header">
                    <div>
                        <div class="mensalista-nome">${m.nome || 'Sem nome'}</div>
                        <span style="background:${isPrincipal ? 'rgba(51,102,255,0.2)' : 'rgba(255,170,0,0.2)'}; color:${isPrincipal ? '#3366ff' : '#ffaa00'}; padding:4px 12px; border-radius:20px; margin-top:5px; display:inline-block; font-weight:600;">
                            ${m.barbeiro || 'N/A'} ${isPrincipal ? '‚≠ê' : ''}
                        </span>
                    </div>
                    <div class="mensalista-actions">
                        <span class="status-tag ${statusClass}">${statusTexto}</span>
                        ${m.status !== 'pago' ? `<button class="action-btn success" onclick="pagarMensalidade(${m.id})" title="Pagar mensalidade">üí∞</button>` : ''}
                        <button class="action-btn" onclick="removerMensalista(${m.id})" title="Remover mensalista">üóëÔ∏è</button>
                    </div>
                </div>
                <div class="mensalista-detalhes">
                    <div class="mensalista-detalhes-item">
                        <div class="mensalista-detalhes-label">Valor Mensal</div>
                        <div class="mensalista-valor">R$ ${(m.valor || 0).toFixed(2)}</div>
                    </div>
                    <div class="mensalista-detalhes-item">
                        <div class="mensalista-detalhes-label">Vencimento</div>
                        <div>${dataVenc}</div>
                    </div>
                    ${m.telefone ? `<div class="mensalista-detalhes-item">
                        <div class="mensalista-detalhes-label">Contato</div>
                        <div class="mensalista-telefone">${m.telefone}</div>
                    </div>` : ''}
                </div>
                ${m.observacoes ? `
                    <div style="font-size:12px; color:#aaa; margin-top:10px; padding-top:10px; border-top:1px solid rgba(255,255,255,0.1);">
                        üìù ${m.observacoes}
                    </div>
                ` : ''}
            </div>`;
        });
    } else {
        html = `<div class="empty-state">
            <div class="empty-state-icon">üë•</div>
            <div class="empty-state-title">Nenhum mensalista encontrado</div>
            <div class="empty-state-subtitle">
                ${status === 'vencido' ? '‚úÖ Todos os mensalistas est√£o em dia!' : 
                  status === 'hoje' ? 'üéâ Ningu√©m vence hoje!' : 
                  'Cadastre seu primeiro mensalista'}
            </div>
            <button class="btn btn-success" onclick="abrirModalMensalistas()" style="margin-top:20px;">+ Novo Mensalista</button>
        </div>`;
    }
    
    const listaMensalistas = document.getElementById('listaMensalistasDashboard');
    if (listaMensalistas) listaMensalistas.innerHTML = html;
}

function removerMensalista(id) {
    if (!confirm('‚ö†Ô∏è Remover mensalista permanentemente?')) return;
    
    const index = (dados.mensalistas || []).findIndex(m => m.id === id);
    if (index === -1) return;
    
    dados.mensalistas.splice(index, 1);
    salvarDadosLocalmente();
    atualizarDashboardCompleto();
    alert('‚úÖ Mensalista removido!');
}

function pagarMensalidade(id) {
    const m = (dados.mensalistas || []).find(m => m.id === id);
    if (!m) return;
    
    if (!confirm(`üíµ Registrar pagamento de R$ ${(m.valor || 0).toFixed(2)} para ${m.nome || 'cliente'}?`)) return;
    
    const hoje = new Date().toISOString().split('T')[0];
    
    if (!m.historicoPagamentos) m.historicoPagamentos = [];
    m.historicoPagamentos.push({ data: hoje, valor: m.valor || 0 });
    
    m.status = 'pago';
    m.dataUltimoPagamento = hoje;
    
    const vencAtual = new Date(m.dataVencimento || m.vencimento || hoje);
    const proxVenc = new Date(vencAtual.getFullYear(), vencAtual.getMonth() + 1, m.diaVencimento || vencAtual.getDate());
    m.dataVencimento = proxVenc.toISOString().split('T')[0];
    m.vencimento = m.dataVencimento;
    
    salvarDadosLocalmente();
    atualizarDashboardCompleto();
    alert('‚úÖ Pagamento registrado!');
}

function adicionarOuAtualizarMensalista() {
    const nome = document.getElementById('nomeMensalista')?.value?.trim();
    const telefone = document.getElementById('telefoneMensalista')?.value?.trim();
    const barbeiro = document.getElementById('barbeiroMensalista')?.value;
    const valor = parseFloat(document.getElementById('valorMensalista')?.value);
    const dataInicio = document.getElementById('dataInicioMensalista')?.value;
    const diaVencimento = parseInt(document.getElementById('diaVencimentoMensalista')?.value);
    const status = document.getElementById('statusMensalista')?.value || 'pendente';
    const observacoes = document.getElementById('observacoesMensalista')?.value?.trim();
    
    if (!nome || !barbeiro || isNaN(valor) || !dataInicio || !diaVencimento) {
        alert('‚ùå Preencha todos os campos obrigat√≥rios!');
        return;
    }
    
    const dataInicioObj = new Date(dataInicio);
    let dataVencimento = new Date(dataInicioObj.getFullYear(), dataInicioObj.getMonth(), diaVencimento);
    if (dataVencimento < dataInicioObj) {
        dataVencimento = new Date(dataInicioObj.getFullYear(), dataInicioObj.getMonth() + 1, diaVencimento);
    }
    
    if (!dados.mensalistas) dados.mensalistas = [];
    
    const id = dados.mensalistas.length > 0 ? Math.max(...dados.mensalistas.map(m => m.id || 0)) + 1 : 1;
    
    dados.mensalistas.push({
        id, 
        nome, 
        telefone, 
        barbeiro, 
        valor,
        dataInicio, 
        diaVencimento,
        dataVencimento: dataVencimento.toISOString().split('T')[0],
        vencimento: dataVencimento.toISOString().split('T')[0],
        status, 
        observacoes,
        historicoPagamentos: []
    });
    
    salvarDadosLocalmente();
    limparFormMensalista();
    atualizarDashboardCompleto();
    fecharModal('modalMensalistas');
    alert('‚úÖ Mensalista cadastrado!');
}

function limparFormMensalista() {
    const nome = document.getElementById('nomeMensalista');
    const telefone = document.getElementById('telefoneMensalista');
    const valor = document.getElementById('valorMensalista');
    const observacoes = document.getElementById('observacoesMensalista');
    const dataInicio = document.getElementById('dataInicioMensalista');
    const diaVencimento = document.getElementById('diaVencimentoMensalista');
    
    if (nome) nome.value = '';
    if (telefone) telefone.value = '';
    if (valor) valor.value = '';
    if (observacoes) observacoes.value = '';
    
    const hoje = new Date();
    if (dataInicio) dataInicio.value = hoje.toISOString().split('T')[0];
    if (diaVencimento) diaVencimento.value = hoje.getDate();
}

function limparFiltrosMensalistas() {
    const dataInicio = document.getElementById('dataInicioMensalistas');
    const dataFim = document.getElementById('dataFimMensalistas');
    const filtroStatus = document.getElementById('filtroStatusMensalistas');
    const filtroBarbeiro = document.getElementById('filtroBarbeiroMensalistas');
    
    if (dataInicio) dataInicio.value = '';
    if (dataFim) dataFim.value = '';
    if (filtroStatus) filtroStatus.value = 'todos';
    if (filtroBarbeiro) filtroBarbeiro.value = 'todos';
    
    filtrarMensalistasPorStatus('todos');
}

// ========== CONFIGURA√á√ïES ==========
function salvarConfiguracoes() {
    const whatsapp = document.getElementById('numWhats')?.value?.trim();
    const novoPin = document.getElementById('novoPin')?.value?.trim();
    const corte = parseFloat(document.getElementById('valCorte')?.value);
    const barba = parseFloat(document.getElementById('valBarba')?.value);
    const combo = parseFloat(document.getElementById('valCombo')?.value);
    const orcamentoDespesas = parseFloat(document.getElementById('orcamentoDespesas')?.value);
    const notificacoesAtivas = document.getElementById('notificacoesAtivas')?.value === 'true';
    const diasAlerta = parseInt(document.getElementById('diasAlerta')?.value);
    
    if (isNaN(corte) || isNaN(barba) || isNaN(combo) || isNaN(orcamentoDespesas) || isNaN(diasAlerta)) {
        alert('‚ùå Valores inv√°lidos!');
        return;
    }
    
    if (!dados.config) dados.config = {};
    
    if (whatsapp) dados.config.whatsapp = whatsapp;
    if (novoPin) dados.config.pin = novoPin;
    dados.config.corte = corte;
    dados.config.barba = barba;
    dados.config.combo = combo;
    dados.config.orcamentoDespesas = orcamentoDespesas;
    dados.config.notificacoesAtivas = notificacoesAtivas;
    dados.config.diasAlerta = diasAlerta;
    
    salvarDadosLocalmente();
    fecharModal('modalConfig');
    alert('‚úÖ Configura√ß√µes salvas!');
}

// ========== MODAIS ==========
function abrirModalDespesas() {
    atualizarResumoFinanceiroDespesas();
    atualizarListaDespesasModal();
    const modal = document.getElementById('modalDespesas');
    if (modal) modal.style.display = 'flex';
}

function abrirModalMensalistas() {
    const modal = document.getElementById('modalMensalistas');
    if (modal) modal.style.display = 'flex';
}

function abrirModalResumoCompleto() {
    const hoje = new Date();
    const mesAtual = hoje.getMonth();
    const anoAtual = hoje.getFullYear();
    
    const servicosWagner = dados.Wagner ? dados.Wagner.filter(s => {
        if (!s.data) return false;
        const d = new Date(s.data);
        return d.getMonth() === mesAtual && d.getFullYear() === anoAtual;
    }) : [];
    
    const servicosGabriel = dados.Gabriel ? dados.Gabriel.filter(s => {
        if (!s.data) return false;
        const d = new Date(s.data);
        return d.getMonth() === mesAtual && d.getFullYear() === anoAtual;
    }) : [];
    
    const totalWagner = servicosWagner.reduce((s, v) => s + (v.valor || 0), 0);
    const totalGabriel = servicosGabriel.reduce((s, v) => s + (v.valor || 0), 0);
    const totalMes = totalWagner + totalGabriel;
    const fiadoWagner = servicosWagner.filter(s => !s.pago).reduce((s, v) => s + (v.valor || 0), 0);
    const fiadoGabriel = servicosGabriel.filter(s => !s.pago).reduce((s, v) => s + (v.valor || 0), 0);
    const despesasMes = dados.despesas ? dados.despesas.filter(d => {
        if (!d.data) return false;
        const data = new Date(d.data);
        return data.getMonth() === mesAtual && data.getFullYear() === anoAtual;
    }).reduce((s, d) => s + (d.valor || 0), 0) : 0;
    
    const html = `<div style="padding:20px;">
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;">
            <div style="background:rgba(51,102,255,0.1); padding:20px; border-radius:15px;">
                <h3 style="color:#3366ff; margin-bottom:10px;">üë®‚Äçü¶± WAGNER ‚≠ê</h3>
                <div style="font-size:28px; font-weight:800;">R$ ${totalWagner.toFixed(2)}</div>
                <div style="display:flex; justify-content:space-between; margin-top:15px;">
                    <span>‚úÖ R$ ${(totalWagner - fiadoWagner).toFixed(2)}</span>
                    <span style="color:#FF9500;">‚è≥ R$ ${fiadoWagner.toFixed(2)}</span>
                </div>
                <div style="margin-top:10px; color:#aaa;">${servicosWagner.length} servi√ßos</div>
            </div>
            <div style="background:rgba(255,170,0,0.1); padding:20px; border-radius:15px;">
                <h3 style="color:#ffaa00; margin-bottom:10px;">üë®‚Äçü¶± GABRIEL</h3>
                <div style="font-size:28px; font-weight:800;">R$ ${totalGabriel.toFixed(2)}</div>
                <div style="display:flex; justify-content:space-between; margin-top:15px;">
                    <span>‚úÖ R$ ${(totalGabriel - fiadoGabriel).toFixed(2)}</span>
                    <span style="color:#FF9500;">‚è≥ R$ ${fiadoGabriel.toFixed(2)}</span>
                </div>
                <div style="margin-top:10px; color:#aaa;">${servicosGabriel.length} servi√ßos</div>
            </div>
        </div>
        <div style="background:rgba(255,51,102,0.1); padding:20px; border-radius:15px; margin-bottom:20px;">
            <div style="display:flex; justify-content:space-between;">
                <div>
                    <div style="color:#ff3366; font-size:14px;">DESPESAS M√äS</div>
                    <div style="font-size:28px; font-weight:800; color:#ff3366;">R$ ${despesasMes.toFixed(2)}</div>
                </div>
                <div>
                    <div style="color:#25D366; font-size:14px;">LUCRO L√çQUIDO</div>
                    <div style="font-size:32px; font-weight:800; color:#25D366;">R$ ${(totalMes - despesasMes).toFixed(2)}</div>
                </div>
            </div>
        </div>
        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:15px; text-align:center;">
            <div>
                <div style="color:#aaa; font-size:12px;">RECEITA TOTAL</div>
                <div style="font-size:20px; font-weight:700; color:#25D366;">R$ ${totalMes.toFixed(2)}</div>
            </div>
            <div>
                <div style="color:#aaa; font-size:12px;">SERVI√áOS</div>
                <div style="font-size:20px; font-weight:700;">${servicosWagner.length + servicosGabriel.length}</div>
            </div>
            <div>
                <div style="color:#aaa; font-size:12px;">M√âDIA/SERVI√áO</div>
                <div style="font-size:20px; font-weight:700; color:#ffaa00;">R$ ${(totalMes / ((servicosWagner.length + servicosGabriel.length) || 1)).toFixed(2)}</div>
            </div>
        </div>
    </div>`;
    
    const conteudoResumo = document.getElementById('conteudoResumo');
    if (conteudoResumo) conteudoResumo.innerHTML = html;
    
    const modal = document.getElementById('modalResumo');
    if (modal) modal.style.display = 'flex';
}

function abrirModalPagamentos() {
    const modal = document.getElementById('modalPagamentos');
    if (modal) {
        modal.style.display = 'flex';
        gerarRelatorioPagamentosDetalhado();
    }
}

function abrirModalConfiguracoes() {
    const numWhats = document.getElementById('numWhats');
    const novoPin = document.getElementById('novoPin');
    const valCorte = document.getElementById('valCorte');
    const valBarba = document.getElementById('valBarba');
    const valCombo = document.getElementById('valCombo');
    const orcamentoDespesas = document.getElementById('orcamentoDespesas');
    const notificacoesAtivas = document.getElementById('notificacoesAtivas');
    const diasAlerta = document.getElementById('diasAlerta');
    
    if (numWhats) numWhats.value = dados.config?.whatsapp || '';
    if (novoPin) novoPin.value = '';
    if (valCorte) valCorte.value = dados.config?.corte || 28;
    if (valBarba) valBarba.value = dados.config?.barba || 15;
    if (valCombo) valCombo.value = dados.config?.combo || 40;
    if (orcamentoDespesas) orcamentoDespesas.value = dados.config?.orcamentoDespesas || 1500;
    if (notificacoesAtivas) notificacoesAtivas.value = dados.config?.notificacoesAtivas ? 'true' : 'false';
    if (diasAlerta) diasAlerta.value = dados.config?.diasAlerta || 3;
    
    const modal = document.getElementById('modalConfig');
    if (modal) modal.style.display = 'flex';
}

function fecharModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) modal.style.display = 'none';
}

// ========== FUN√á√ïES AUXILIARES ==========
function formatarDataBR(data) {
    if (!data) return '';
    try {
        const d = new Date(data + 'T12:00:00');
        return d.toLocaleDateString('pt-BR');
    } catch (e) {
        return data;
    }
}

function voltarParaRegistro() {
    window.location.href = '/';
}

function iniciarVerificacoesPeriodicas() {
    setInterval(verificarVencimentosMensalistas, 300000);
}

function verificarVencimentosMensalistas() {
    if (!dados.config?.notificacoesAtivas) return;
    
    (dados.mensalistas || []).forEach(m => {
        if (m.status === 'pago') return;
        
        const hoje = new Date();
        hoje.setHours(0, 0, 0, 0);
        const venc = new Date(m.dataVencimento || m.vencimento);
        venc.setHours(0, 0, 0, 0);
        
        if (venc < hoje && m.status !== 'vencido') {
            m.status = 'vencido';
        }
    });
}

function atualizarResumoFinanceiroDespesas() {
    const hoje = new Date();
    const mes = hoje.getMonth();
    const ano = hoje.getFullYear();
    
    const despesasMes = (dados.despesas || []).filter(d => {
        if (!d.data) return false;
        const data = new Date(d.data);
        return data.getMonth() === mes && data.getFullYear() === ano;
    });
    
    const total = despesasMes.reduce((s, d) => s + (d.valor || 0), 0);
    const orcamento = dados.config?.orcamentoDespesas || 1500;
    const percentual = (total / orcamento) * 100;
    
    let html = `<div style="display:flex; justify-content:space-between; margin-bottom:10px;">
        <div><span style="color:#aaa;">Or√ßamento:</span> R$ ${orcamento.toFixed(2)}</div>
        <div><span style="color:#aaa;">Gasto:</span> R$ ${total.toFixed(2)}</div>
    </div>
    <div class="progresso-despesa">
        <div class="progresso-bar" style="width:${Math.min(percentual, 100)}%; background:${percentual > 100 ? '#ff3366' : '#ff6699'};"></div>
    </div>
    <div style="text-align:center; margin-top:10px; color:${percentual > 100 ? '#ff3366' : '#aaa'};">
        ${percentual.toFixed(1)}% utilizado
    </div>`;
    
    const resumoFinanceiro = document.getElementById('resumoFinanceiroDespesas');
    if (resumoFinanceiro) resumoFinanceiro.innerHTML = html;
}

function gerarRelatorioPagamentosDetalhado() {
    const dataInicio = document.getElementById('dataInicioPagamentos')?.value;
    const dataFim = document.getElementById('dataFimPagamentos')?.value;
    const filtroBarbeiro = document.getElementById('filtroBarbeiroPagamentos')?.value || 'todos';
    
    if (!dataInicio || !dataFim) return;
    
    let servicos = [...(dados.Wagner || []), ...(dados.Gabriel || [])].filter(s => 
        s.data && s.data >= dataInicio && s.data <= dataFim &&
        (filtroBarbeiro === 'todos' || s.barbeiro === filtroBarbeiro)
    );
    
    const total = servicos.reduce((s, v) => s + (v.valor || 0), 0);
    const pago = servicos.filter(s => s.pago).reduce((s, v) => s + (v.valor || 0), 0);
    
    const html = `<div style="background:rgba(51,102,255,0.1); padding:20px; border-radius:15px;">
        <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:15px; text-align:center;">
            <div><div style="color:#aaa;">TOTAL</div><div style="font-size:24px; color:#25D366;">R$ ${total.toFixed(2)}</div></div>
            <div><div style="color:#aaa;">SERVI√áOS</div><div style="font-size:24px;">${servicos.length}</div></div>
            <div><div style="color:#aaa;">RECEBIDO</div><div style="font-size:20px; color:#25D366;">R$ ${pago.toFixed(2)}</div></div>
            <div><div style="color:#aaa;">FIADO</div><div style="font-size:20px; color:#FF9500;">R$ ${(total - pago).toFixed(2)}</div></div>
        </div>
    </div>`;
    
    const relatorio = document.getElementById('relatorioPagamentosDetalhado');
    if (relatorio) relatorio.innerHTML = html;
}

function enviarRelatorioWhatsApp(tipo) {
    const numero = dados.config?.whatsapp || '11974065186';
    
    if (!numero || numero.replace(/\D/g, '').length < 10) {
        alert('‚ùå Configure o WhatsApp nas configura√ß√µes!');
        abrirModalConfiguracoes();
        return;
    }
    
    let msg = '';
    const hoje = new Date();
    
    if (tipo === 'resumo') {
        const mes = hoje.getMonth();
        const ano = hoje.getFullYear();
        
        const w = dados.Wagner ? dados.Wagner.filter(s => {
            if (!s.data) return false;
            const d = new Date(s.data);
            return d.getMonth() === mes && d.getFullYear() === ano;
        }) : [];
        
        const g = dados.Gabriel ? dados.Gabriel.filter(s => {
            if (!s.data) return false;
            const d = new Date(s.data);
            return d.getMonth() === mes && d.getFullYear() === ano;
        }) : [];
        
        const tw = w.reduce((s, v) => s + (v.valor || 0), 0);
        const tg = g.reduce((s, v) => s + (v.valor || 0), 0);
        
        msg = `*üìä RESUMO ${hoje.toLocaleDateString('pt-BR', {month:'long', year:'numeric'}).toUpperCase()}*%0A%0A` +
              `*WAGNER (PRINCIPAL):* ${w.length} servi√ßos - R$ ${tw.toFixed(2)}%0A` +
              `*GABRIEL (AUXILIAR):* ${g.length} servi√ßos - R$ ${tg.toFixed(2)}%0A` +
              `*TOTAL:* R$ ${(tw+tg).toFixed(2)}%0A%0A` +
              `*BarbaPRO Duo*`;
        
        window.open(`https://wa.me/55${numero.replace(/\D/g, '')}?text=${msg}`, '_blank');
    }
}

function enviarLembretesMensalistas() {
    const pendentes = (dados.mensalistas || []).filter(m => m.status === 'pendente' || m.status === 'vencido');
    alert(`üì¢ ${pendentes.length} mensalista(s) pendente(s)`);
}

function exportarDadosDespesas() {
    alert('üì§ Exportar despesas - Em breve');
}

function exportarDadosServicos() {
    alert('üì§ Exportar servi√ßos - Em breve');
}
    </script>
</body>
</html>