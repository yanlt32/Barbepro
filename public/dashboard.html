<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BarbaPRO Duo - Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Reset e Configura√ß√µes Gerais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header Profissional */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255,170,0,0.1) 0%, rgba(51,102,255,0.1) 100%);
            border-radius: 20px;
            border: 1px solid rgba(255,170,0,0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 40px;
            background: linear-gradient(135deg, #ffaa00, #ff7733);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        .logo h1 {
            background: linear-gradient(135deg, #ffaa00, #ff7733);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 28px;
            font-weight: 800;
            letter-spacing: 1px;
        }
        
        .logo-subtitle {
            color: #aaa;
            font-size: 14px;
            margin-top: 4px;
            font-weight: 400;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* Bot√µes Modernos */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::after {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ffaa00 0%, #ff7733 100%);
            color: #000;
            box-shadow: 0 6px 20px rgba(255,170,0,0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
        }
        
        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(37,211,102,0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00cc99 0%, #009973 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(0,204,153,0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff3366 0%, #cc0033 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(255,51,102,0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        /* Dashboard Grid Moderno */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* Cards Modernos */
        .card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ffaa00, #ff7733);
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            border-color: rgba(255,170,0,0.3);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .card-title {
            color: #ffaa00;
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Estat√≠sticas Profissionais */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            background: rgba(255,255,255,0.05);
            transform: translateY(-3px);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffaa00, #ff7733);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            font-size: 13px;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .stat-secondary .stat-value {
            background: linear-gradient(135deg, #25D366, #128C7E);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-warning .stat-value {
            background: linear-gradient(135deg, #FF9500, #FF7733);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-danger .stat-value {
            background: linear-gradient(135deg, #ff3366, #cc0033);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Tabelas Modernas */
        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 15px;
            overflow: hidden;
            background: rgba(255,255,255,0.03);
        }
        
        th {
            background: linear-gradient(135deg, rgba(255,170,0,0.1), rgba(255,170,0,0.05));
            padding: 18px 15px;
            text-align: left;
            font-weight: 700;
            color: #ffaa00;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid rgba(255,170,0,0.2);
        }
        
        td {
            padding: 16px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 14px;
        }
        
        tr:hover {
            background: rgba(255,255,255,0.03);
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        /* Status Tags */
        .status-tag {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pago {
            background: linear-gradient(135deg, rgba(37,211,102,0.2), rgba(37,211,102,0.1));
            color: #25D366;
            border: 1px solid rgba(37,211,102,0.3);
        }
        
        .status-pendente {
            background: linear-gradient(135deg, rgba(255,149,0,0.2), rgba(255,149,0,0.1));
            color: #FF9500;
            border: 1px solid rgba(255,149,0,0.3);
        }
        
        .status-vencido {
            background: linear-gradient(135deg, rgba(255,51,102,0.2), rgba(255,51,102,0.1));
            color: #ff3366;
            border: 1px solid rgba(255,51,102,0.3);
            animation: pulse 2s infinite;
        }
        
        /* Mensalistas Cards */
        .mensalista-card {
            background: linear-gradient(135deg, rgba(0,204,153,0.05), rgba(0,204,153,0.02));
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(0,204,153,0.1);
            border-left: 4px solid #00cc99;
            transition: all 0.3s ease;
        }
        
        .mensalista-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,204,153,0.1);
        }
        
        .mensalista-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .mensalista-nome {
            font-weight: 700;
            font-size: 16px;
            color: #fff;
        }
        
        .mensalista-actions {
            display: flex;
            gap: 8px;
        }
        
        .mensalista-detalhes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .mensalista-detalhes-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .mensalista-detalhes-label {
            color: #aaa;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .mensalista-detalhes-value {
            color: #fff;
            font-weight: 600;
        }
        
        .mensalista-valor {
            color: #00cc99;
            font-weight: 700;
            font-size: 18px;
        }
        
        .mensalista-telefone {
            color: #25D366;
            font-weight: 600;
        }
        
        /* Filtros Modernos */
        .filtro-container {
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .filtro-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .input-group label {
            font-size: 14px;
            color: #ffaa00;
            font-weight: 600;
        }
        
        /* CORRE√á√ÉO DA SELECT BOX */
        input, select, textarea {
            padding: 14px;
            border: 1px solid rgba(255,255,255,0.15);
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        select option {
            background-color: #0a0a0a;
            color: #fff;
            padding: 12px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ffaa00;
            box-shadow: 0 0 0 3px rgba(255,170,0,0.1);
        }
        
        /* Modais Modernos */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(26,26,46,0.95) 0%, rgba(22,33,62,0.95) 100%);
            border-radius: 25px;
            padding: 35px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255,170,0,0.3);
            box-shadow: 0 30px 60px rgba(0,0,0,0.6);
            position: relative;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255,170,0,0.3);
        }
        
        .modal-title {
            color: #ffaa00;
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #ffaa00, #ff7733);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .close-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255,170,0,0.2);
            transform: rotate(90deg);
        }
        
        /* Formul√°rios Modernos */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .form-group label {
            color: #ffaa00;
            font-weight: 700;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Gr√°ficos */
        .grafico-container {
            height: 320px;
            margin-top: 20px;
            position: relative;
        }
        
        /* Notifica√ß√µes */
        .notificacao {
            background: linear-gradient(135deg, rgba(255,51,102,0.1), rgba(255,51,102,0.05));
            border: 2px solid rgba(255,51,102,0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        .notificacao-titulo {
            color: #ff3366;
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* A√ß√µes */
        .action-btn {
            background: rgba(255, 50, 50, 0.2);
            color: #ff3366;
            border: 1px solid rgba(255, 50, 50, 0.3);
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: bold;
            font-size: 18px;
        }
        
        .action-btn:hover {
            background: rgba(255, 50, 50, 0.3);
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 5px 15px rgba(255,50,50,0.3);
        }
        
        .action-btn.success {
            background: rgba(0, 204, 153, 0.2);
            color: #00cc99;
            border-color: rgba(0, 204, 153, 0.3);
        }
        
        .action-btn.success:hover {
            background: rgba(0, 204, 153, 0.3);
        }
        
        /* Anima√ß√µes */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsividade */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .header-actions {
                width: 100%;
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .filtro-grid {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 12px 20px;
            }
            
            .modal-content {
                padding: 25px 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px 15px;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            .stat-value {
                font-size: 28px;
            }
        }
        
        /* Scrollbar Personalizada */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ffaa00, #ff7733);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #ff7733, #ffaa00);
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .badge-success {
            background: linear-gradient(135deg, rgba(37,211,102,0.2), rgba(37,211,102,0.1));
            color: #25D366;
            border: 1px solid rgba(37,211,102,0.3);
        }
        
        .badge-warning {
            background: linear-gradient(135deg, rgba(255,149,0,0.2), rgba(255,149,0,0.1));
            color: #FF9500;
            border: 1px solid rgba(255,149,0,0.3);
        }
        
        .badge-danger {
            background: linear-gradient(135deg, rgba(255,51,102,0.2), rgba(255,51,102,0.1));
            color: #ff3366;
            border: 1px solid rgba(255,51,102,0.3);
        }
        
        /* Tooltips */
        [data-tooltip] {
            position: relative;
        }
        
        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 8px;
            border: 1px solid rgba(255,170,0,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Moderno -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">üíà</div>
                <div>
                    <h1>BarbaPRO Duo</h1>
                    <div class="logo-subtitle">Dashboard Profissional</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" id="btnVoltarRegistro">
                    ‚Üê Voltar ao Registro
                </button>
                <button class="btn btn-whatsapp" id="btnEnviarResumo">
                    üì± Resumo WhatsApp
                </button>
                <button class="btn btn-secondary" id="btnConfiguracoes">
                    ‚öôÔ∏è Configura√ß√µes
                </button>
            </div>
        </header>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Card: Estat√≠sticas Gabriel -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üë®‚Äçü¶± GABRIEL</div>
                    <div class="badge badge-success">HOJE</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="gabrielHoje">0</div>
                        <div class="stat-label">Servi√ßos Hoje</div>
                    </div>
                    <div class="stat-item stat-secondary">
                        <div class="stat-value" id="gabrielTotalHoje">R$ 0</div>
                        <div class="stat-label">Total Hoje</div>
                    </div>
                    <div class="stat-item stat-warning">
                        <div class="stat-value" id="gabrielFiadoHoje">R$ 0</div>
                        <div class="stat-label">Fiado Hoje</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="gabrielMedia">R$ 0</div>
                        <div class="stat-label">M√©dia/Servi√ßo</div>
                    </div>
                </div>
            </div>

            <!-- Card: Estat√≠sticas Wagner -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üë®‚Äçü¶± WAGNER</div>
                    <div class="badge badge-success">HOJE</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="wagnerHoje">0</div>
                        <div class="stat-label">Servi√ßos Hoje</div>
                    </div>
                    <div class="stat-item stat-secondary">
                        <div class="stat-value" id="wagnerTotalHoje">R$ 0</div>
                        <div class="stat-label">Total Hoje</div>
                    </div>
                    <div class="stat-item stat-warning">
                        <div class="stat-value" id="wagnerFiadoHoje">R$ 0</div>
                        <div class="stat-label">Fiado Hoje</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="wagnerMedia">R$ 0</div>
                        <div class="stat-label">M√©dia/Servi√ßo</div>
                    </div>
                </div>
            </div>

            <!-- Card: Estat√≠sticas Gerais -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üìä ESTAT√çSTICAS GERAIS</div>
                    <div class="badge badge-warning">M√äS ATUAL</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalMes">R$ 0</div>
                        <div class="stat-label">Total M√™s</div>
                    </div>
                    <div class="stat-item stat-secondary">
                        <div class="stat-value" id="servicosMes">0</div>
                        <div class="stat-label">Servi√ßos M√™s</div>
                    </div>
                    <div class="stat-item stat-warning">
                        <div class="stat-value" id="fiadoMes">R$ 0</div>
                        <div class="stat-label">Fiado Total</div>
                    </div>
                    <div class="stat-item stat-danger">
                        <div class="stat-value" id="despesasMes">R$ 0</div>
                        <div class="stat-label">Despesas M√™s</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Segunda Linha: Pagamentos e M√©todos -->
        <div class="dashboard-grid">
            <!-- Card: Resumo Pagamentos Hoje -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üí∞ PAGAMENTOS - HOJE</div>
                    <div class="badge badge-success">RESUMO</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item" onclick="filtrarPorMetodo('dinheiro')">
                        <div class="stat-value" id="totalDinheiro">R$ 0</div>
                        <div class="stat-label">üíµ DINHEIRO</div>
                    </div>
                    <div class="stat-item" onclick="filtrarPorMetodo('pix')">
                        <div class="stat-value" id="totalPix">R$ 0</div>
                        <div class="stat-label">üì± PIX</div>
                    </div>
                    <div class="stat-item" onclick="filtrarPorMetodo('debito')">
                        <div class="stat-value" id="totalDebito">R$ 0</div>
                        <div class="stat-label">üí≥ D√âBITO</div>
                    </div>
                    <div class="stat-item" onclick="filtrarPorMetodo('credito')">
                        <div class="stat-value" id="totalCredito">R$ 0</div>
                        <div class="stat-label">üí≥ CR√âDITO</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn btn-whatsapp" id="btnEnviarPagamentos" style="width: 100%;">
                        üì± Enviar Relat√≥rio
                    </button>
                </div>
            </div>

            <!-- Card: Gr√°fico Distribui√ß√£o -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üìà DISTRIBUI√á√ÉO - HOJE</div>
                    <div class="badge badge-warning">GR√ÅFICO</div>
                </div>
                <div class="grafico-container">
                    <canvas id="graficoPizza"></canvas>
                </div>
            </div>

            <!-- Card: A√ß√µes R√°pidas -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">‚ö° A√á√ïES R√ÅPIDAS</div>
                    <div class="badge badge-success">MENU</div>
                </div>
                <div style="display: grid; gap: 15px; padding: 10px;">
                    <button class="btn btn-primary" id="btnVerResumoCompleto">
                        üìä Ver Resumo Completo
                    </button>
                    <button class="btn btn-success" id="btnRelatorioDetalhado">
                        üìÑ Relat√≥rio Detalhado
                    </button>
                    <button class="btn btn-whatsapp" id="btnEnviarMensalistas">
                        üë• Enviar Lembretes
                    </button>
                </div>
            </div>
        </div>

        <!-- Terceira Linha: Mensalistas -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">üë• MENSALISTAS - GERENCIAMENTO</div>
                <div>
                    <button class="btn btn-success" id="btnNovoMensalista" style="margin-right: 10px;">
                        + Novo Mensalista
                    </button>
                </div>
            </div>
            
            <!-- Filtros Mensalistas -->
            <div class="filtro-container">
                <div class="filtro-grid">
                    <div class="input-group">
                        <label>üìÖ Data In√≠cio</label>
                        <input type="date" id="dataInicioMensalistas">
                    </div>
                    <div class="input-group">
                        <label>üìÖ Data Fim</label>
                        <input type="date" id="dataFimMensalistas">
                    </div>
                    <div class="input-group">
                        <label>üìä Status</label>
                        <select id="filtroStatusMensalistas">
                            <option value="todos">üìã Todos os Status</option>
                            <option value="pago">‚úÖ Pagos</option>
                            <option value="pendente">‚è≥ Pendentes</option>
                            <option value="vencido">‚ö†Ô∏è Vencidos</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>üë§ Barbeiro</label>
                        <select id="filtroBarbeiroMensalistas">
                            <option value="todos">üë• Todos Barbeiros</option>
                            <option value="Gabriel">üë®‚Äçü¶± Gabriel</option>
                            <option value="Wagner">üë®‚Äçü¶± Wagner</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: flex-end;">
                        <button class="btn btn-primary" id="btnFiltrarMensalistas" style="width: 100%;">
                            üîç Aplicar Filtros
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Notifica√ß√µes de Vencimento -->
            <div id="notificacoesVencimento">
                <!-- Din√¢mico -->
            </div>
            
            <!-- Lista de Mensalistas -->
            <div id="listaMensalistasDashboard">
                <!-- Conte√∫do din√¢mico -->
            </div>
        </div>

        <!-- Quarta Linha: Servi√ßos Recentes -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">üìù SERVI√áOS RECENTES</div>
                <button class="btn btn-secondary" id="btnExportarServicos">
                    üì§ Exportar Dados
                </button>
            </div>
            
            <!-- Filtros Servi√ßos -->
            <div class="filtro-container">
                <div class="filtro-grid">
                    <div class="input-group">
                        <label>üìÖ Data In√≠cio</label>
                        <input type="date" id="dataInicioServicos">
                    </div>
                    <div class="input-group">
                        <label>üìÖ Data Fim</label>
                        <input type="date" id="dataFimServicos">
                    </div>
                    <div class="input-group">
                        <label>üë§ Barbeiro</label>
                        <select id="filtroBarbeiroServicos">
                            <option value="todos">üë• Todos Barbeiros</option>
                            <option value="Gabriel">üë®‚Äçü¶± Gabriel</option>
                            <option value="Wagner">üë®‚Äçü¶± Wagner</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>üí∞ Status Pagamento</label>
                        <select id="filtroPagamentoServicos">
                            <option value="todos">üìã Todos</option>
                            <option value="pago">‚úÖ Pagos</option>
                            <option value="fiado">‚è≥ Fiados</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: flex-end; gap: 10px;">
                        <button class="btn btn-primary" id="btnFiltrarServicos" style="flex: 1;">
                            üîç Filtrar Servi√ßos
                        </button>
                        <button class="btn btn-whatsapp" id="btnEnviarRelatorioServicos" style="flex: 1;">
                            üì± Enviar Relat√≥rio
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Tabela de Servi√ßos -->
            <div class="table-container">
                <div id="listaServicosRecentes">
                    <!-- Conte√∫do din√¢mico -->
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MODAIS ========== -->

    <!-- Modal: Resumo Completo -->
    <div class="modal" id="modalResumo">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìä RESUMO COMPLETO - BARBEIROS</h2>
                <button class="close-btn" data-modal="modalResumo">&times;</button>
            </div>
            <div id="conteudoResumo">
                <!-- Din√¢mico -->
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" data-modal="modalResumo">
                    Fechar
                </button>
                <button class="btn btn-whatsapp" id="btnEnviarResumoCompleto">
                    üì± Enviar por WhatsApp
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Relat√≥rio Pagamentos -->
    <div class="modal" id="modalPagamentos">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üí∞ RELAT√ìRIO DE PAGAMENTOS DETALHADO</h2>
                <button class="close-btn" data-modal="modalPagamentos">&times;</button>
            </div>
            <div class="filtro-container">
                <div class="filtro-grid">
                    <div class="input-group">
                        <label>üìÖ Data In√≠cio</label>
                        <input type="date" id="dataInicioPagamentos">
                    </div>
                    <div class="input-group">
                        <label>üìÖ Data Fim</label>
                        <input type="date" id="dataFimPagamentos">
                    </div>
                    <div class="input-group">
                        <label>üë§ Barbeiro</label>
                        <select id="filtroBarbeiroPagamentos">
                            <option value="todos">üë• Todos Barbeiros</option>
                            <option value="Gabriel">üë®‚Äçü¶± Gabriel</option>
                            <option value="Wagner">üë®‚Äçü¶± Wagner</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: flex-end; gap: 10px;">
                        <button class="btn btn-primary" id="btnGerarRelatorio" style="flex: 1;">
                            üìà Gerar Relat√≥rio
                        </button>
                        <button class="btn btn-whatsapp" id="btnEnviarRelatorioWhatsApp" style="flex: 1;">
                            üì± Enviar WhatsApp
                        </button>
                    </div>
                </div>
            </div>
            <div id="relatorioPagamentosDetalhado">
                <!-- Conte√∫do din√¢mico -->
            </div>
        </div>
    </div>

    <!-- Modal: Mensalistas Detalhado -->
    <div class="modal" id="modalMensalistas">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üë• GERENCIAMENTO DE MENSALISTAS</h2>
                <button class="close-btn" data-modal="modalMensalistas">&times;</button>
            </div>
            
            <!-- Formul√°rio Novo Mensalista -->
            <div class="card" style="margin-bottom: 25px;">
                <div class="card-header">
                    <div class="card-title">‚ûï NOVO MENSALISTA</div>
                    <div class="badge badge-success">CADASTRO</div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>üë§ Nome do Cliente *</label>
                        <input type="text" id="nomeMensalista" placeholder="Nome completo do cliente">
                    </div>
                    <div class="form-group">
                        <label>üì± Telefone (WhatsApp)</label>
                        <input type="tel" id="telefoneMensalista" placeholder="(11) 99999-9999" maxlength="15">
                    </div>
                    <div class="form-group">
                        <label>üë®‚Äçü¶± Barbeiro *</label>
                        <select id="barbeiroMensalista">
                            <option value="Gabriel">Gabriel</option>
                            <option value="Wagner">Wagner</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üí∞ Valor Mensal (R$) *</label>
                        <input type="number" step="0.01" id="valorMensalista" placeholder="120.00">
                    </div>
                    <div class="form-group">
                        <label>üìÖ Data de In√≠cio *</label>
                        <input type="date" id="dataInicioMensalista">
                    </div>
                    <div class="form-group">
                        <label>üìÖ Dia de Vencimento (1-31) *</label>
                        <input type="number" min="1" max="31" id="diaVencimentoMensalista" placeholder="10">
                    </div>
                    <div class="form-group">
                        <label>üìä Status *</label>
                        <select id="statusMensalista">
                            <option value="pago">‚úÖ Pago</option>
                            <option value="pendente">‚è≥ Pendente</option>
                            <option value="vencido">‚ö†Ô∏è Vencido</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üìù Observa√ß√µes</label>
                        <textarea id="observacoesMensalista" rows="2" placeholder="Observa√ß√µes importantes..."></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" id="btnLimparFormMensalista">
                        Limpar Formul√°rio
                    </button>
                    <button class="btn btn-success" id="btnAdicionarMensalista">
                        ‚úÖ Cadastrar Mensalista
                    </button>
                </div>
            </div>
            
            <!-- Lista de Mensalistas -->
            <div id="listaMensalistasModal">
                <!-- Din√¢mico -->
            </div>
        </div>
    </div>

    <!-- Modal: Configura√ß√µes -->
    <div class="modal" id="modalConfig">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚öôÔ∏è CONFIGURA√á√ïES DO SISTEMA</h2>
                <button class="close-btn" data-modal="modalConfig">&times;</button>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>üì± N√∫mero WhatsApp Relat√≥rios</label>
                    <input type="tel" id="numWhats" placeholder="11974065186">
                </div>
                <div class="form-group">
                    <label>üîê Novo PIN (4 d√≠gitos)</label>
                    <input type="password" id="novoPin" maxlength="4" placeholder="****">
                </div>
                <div class="form-group">
                    <label>üí∞ Valor Corte</label>
                    <input type="number" step="0.01" id="valCorte" placeholder="Valor atual: R$ 28.00">
                </div>
                <div class="form-group">
                    <label>üí∞ Valor Barba</label>
                    <input type="number" step="0.01" id="valBarba" placeholder="Valor atual: R$ 15.00">
                </div>
                <div class="form-group">
                    <label>üí∞ Valor Combo</label>
                    <input type="number" step="0.01" id="valCombo" placeholder="Valor atual: R$ 40.00">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" data-modal="modalConfig">
                    Cancelar
                </button>
                <button class="btn btn-primary" id="btnSalvarConfiguracoes">
                    üíæ Salvar Configura√ß√µes
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Enviar PIX para Mensalista -->
    <div class="modal" id="modalEnviarPIX">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üì± ENVIAR PIX PARA MENSALISTA</h2>
                <button class="close-btn" data-modal="modalEnviarPIX">&times;</button>
            </div>
            <div id="conteudoEnviarPIX">
                <!-- Din√¢mico -->
            </div>
        </div>
    </div>

    <!-- JavaScript CORRIGIDO -->
    <script>
        // ========== VARI√ÅVEIS GLOBAIS ==========
        let dados = { 
            Gabriel: [], 
            Wagner: [], 
            despesas: [],
            mensalistas: [],
            config: { 
                pin: '1234', 
                whatsapp: '11974065186', 
                corte: 28, 
                barba: 15, 
                combo: 40
            }
        };

        let graficoPizza = null;
        let filtroMetodoAtual = null;
        let ws = null;

        // ========== INICIALIZA√á√ÉO ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Dashboard inicializando...');
            inicializarDashboard();
        });

        function inicializarDashboard() {
            // Carregar dados (online primeiro, fallback offline)
            carregarDados();
            
            // Configurar datas
            configurarDatasDashboard();
            
            // Configurar event listeners
            configurarEventListenersDashboard();
            
            // Inicializar gr√°ficos
            inicializarGraficos();
            
            // Conectar WebSocket
            conectarWebSocket();
            
            console.log('‚úÖ Dashboard inicializado!');
        }

        async function carregarDados() {
            try {
                // Tentar carregar do servidor primeiro
                const response = await fetch('/api/data');
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        dados = result.data;
                        console.log('üì° Dados carregados do servidor');
                        atualizarDashboardCompleto();
                        return;
                    }
                }
            } catch (error) {
                console.log('üåê Offline, tentando localStorage...');
            }
            
            // Fallback para localStorage
            try {
                const dadosSalvos = localStorage.getItem('barbapro_duo');
                if (dadosSalvos) {
                    const dadosParseados = JSON.parse(dadosSalvos);
                    Object.assign(dados, dadosParseados);
                    console.log('üìÇ Dados carregados do localStorage');
                    atualizarDashboardCompleto();
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
            }
        }

        async function salvarDados() {
            try {
                // Tentar salvar no servidor
                const response = await fetch('/api/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: dados })
                });
                
                if (response.ok) {
                    console.log('üíæ Dados salvos no servidor');
                } else {
                    throw new Error('Falha no servidor');
                }
            } catch (error) {
                // Fallback para localStorage
                localStorage.setItem('barbapro_duo', JSON.stringify(dados));
                console.log('üíæ Dados salvos localmente (offline)');
            }
        }

        function configurarDatasDashboard() {
            const hoje = new Date();
            const umaSemanaAtras = new Date();
            umaSemanaAtras.setDate(hoje.getDate() - 7);
            
            // Configurar datas padr√£o
            const formatarData = (date) => date.toISOString().split('T')[0];
            
            // Servi√ßos recentes
            document.getElementById('dataInicioServicos').value = formatarData(umaSemanaAtras);
            document.getElementById('dataFimServicos').value = formatarData(hoje);
            
            // Pagamentos
            const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            document.getElementById('dataInicioPagamentos').value = formatarData(primeiroDiaMes);
            document.getElementById('dataFimPagamentos').value = formatarData(hoje);
            
            // Mensalistas
            document.getElementById('dataInicioMensalistas').value = formatarData(primeiroDiaMes);
            document.getElementById('dataFimMensalistas').value = formatarData(hoje);
            
            // Novo mensalista
            document.getElementById('dataInicioMensalista').value = formatarData(hoje);
            document.getElementById('diaVencimentoMensalista').value = hoje.getDate();
        }

        function configurarEventListenersDashboard() {
            // Bot√µes principais
            document.getElementById('btnVoltarRegistro').addEventListener('click', voltarParaRegistro);
            document.getElementById('btnConfiguracoes').addEventListener('click', abrirModalConfiguracoes);
            document.getElementById('btnEnviarResumo').addEventListener('click', () => abrirModalResumoCompleto());
            
            // Bot√µes de a√ß√£o r√°pida
            document.getElementById('btnVerResumoCompleto').addEventListener('click', () => abrirModalResumoCompleto());
            document.getElementById('btnRelatorioDetalhado').addEventListener('click', abrirModalPagamentos);
            document.getElementById('btnEnviarMensalistas').addEventListener('click', enviarLembretesMensalistas);
            
            // Bot√µes de mensalistas
            document.getElementById('btnNovoMensalista').addEventListener('click', abrirModalMensalistas);
            document.getElementById('btnFiltrarMensalistas').addEventListener('click', atualizarListaMensalistasDashboard);
            
            // Bot√µes de servi√ßos
            document.getElementById('btnFiltrarServicos').addEventListener('click', atualizarListaServicosRecentes);
            document.getElementById('btnEnviarRelatorioServicos').addEventListener('click', () => enviarRelatorioWhatsApp('servicos'));
            document.getElementById('btnExportarServicos').addEventListener('click', exportarDadosServicos);
            
            // Bot√µes de pagamentos
            document.getElementById('btnEnviarPagamentos').addEventListener('click', () => abrirModalPagamentos());
            document.getElementById('btnGerarRelatorio').addEventListener('click', gerarRelatorioPagamentosDetalhado);
            document.getElementById('btnEnviarRelatorioWhatsApp').addEventListener('click', () => enviarRelatorioWhatsApp('pagamentos'));
            
            // Bot√µes de formul√°rio
            document.getElementById('btnAdicionarMensalista').addEventListener('click', adicionarMensalista);
            document.getElementById('btnLimparFormMensalista').addEventListener('click', limparFormMensalista);
            document.getElementById('btnSalvarConfiguracoes').addEventListener('click', salvarConfiguracoes);
            document.getElementById('btnEnviarResumoCompleto').addEventListener('click', () => enviarRelatorioWhatsApp('resumo'));
            
            // Bot√µes de fechar modal
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modalId = this.getAttribute('data-modal');
                    fecharModal(modalId);
                });
            });
            
            // Filtros
            document.getElementById('filtroStatusMensalistas').addEventListener('change', atualizarListaMensalistasDashboard);
            document.getElementById('filtroBarbeiroMensalistas').addEventListener('change', atualizarListaMensalistasDashboard);
            document.getElementById('filtroBarbeiroServicos').addEventListener('change', atualizarListaServicosRecentes);
            document.getElementById('filtroPagamentoServicos').addEventListener('change', atualizarListaServicosRecentes);
            document.getElementById('filtroBarbeiroPagamentos').addEventListener('change', gerarRelatorioPagamentosDetalhado);
            
            // Fechar modais ao clicar fora
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });
        }

        function inicializarGraficos() {
            const ctxPizza = document.getElementById('graficoPizza').getContext('2d');
            
            graficoPizza = new Chart(ctxPizza, {
                type: 'pie',
                data: {
                    labels: ['Gabriel', 'Wagner', 'Fiado'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: [
                            'rgba(255, 170, 0, 0.8)',
                            'rgba(51, 102, 255, 0.8)',
                            'rgba(255, 51, 102, 0.8)'
                        ],
                        borderColor: [
                            'rgba(255, 170, 0, 1)',
                            'rgba(51, 102, 255, 1)',
                            'rgba(255, 51, 102, 1)'
                        ],
                        borderWidth: 2,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#fff',
                                padding: 20,
                                font: {
                                    size: 13,
                                    family: "'Segoe UI', sans-serif"
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffaa00',
                            bodyColor: '#fff',
                            borderColor: '#ffaa00',
                            borderWidth: 1,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                    return `${label}: R$ ${value.toFixed(2)} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            });
        }

        function conectarWebSocket() {
            try {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.host}`;
                
                ws = new WebSocket(wsUrl);
                
                ws.onopen = function() {
                    console.log('üîó Conectado ao servidor WebSocket');
                };
                
                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        
                        if (data.type === 'notificacao') {
                            mostrarNotificacaoWebSocket(data);
                        }
                        
                        if (data.type === 'atualizar' || data.type === 'data_updated') {
                            console.log('üîÑ Recebida solicita√ß√£o para atualizar dados');
                            carregarDados();
                        }
                        
                        if (data.type === 'mensalista_removido') {
                            console.log(`üóëÔ∏è Mensalista ${data.nome} removido por outro dispositivo`);
                            carregarDados();
                        }
                    } catch (error) {
                        console.error('‚ùå Erro ao processar mensagem WebSocket:', error);
                    }
                };
                
                ws.onclose = function() {
                    console.log('üîå Conex√£o WebSocket fechada');
                };
                
                ws.onerror = function(error) {
                    console.error('‚ùå Erro WebSocket:', error);
                };
                
            } catch (error) {
                console.error('‚ùå Erro ao conectar WebSocket:', error);
            }
        }

        // ========== ATUALIZA√á√ÉO DO DASHBOARD ==========
        function atualizarDashboardCompleto() {
            atualizarEstatisticasBarbeiros();
            atualizarEstatisticasGerais();
            atualizarResumoPagamentos();
            atualizarListaServicosRecentes();
            atualizarListaMensalistasDashboard();
            atualizarGraficoPizza();
            verificarVencimentosMensalistas();
        }

        function atualizarEstatisticasBarbeiros() {
            const hoje = new Date().toISOString().split('T')[0];
            const mesAtual = new Date().getMonth();
            const anoAtual = new Date().getFullYear();
            
            // Gabriel
            const servicosGabrielHoje = dados.Gabriel.filter(s => s.data === hoje);
            const servicosGabrielMes = dados.Gabriel.filter(s => {
                const dataServico = new Date(s.data);
                return dataServico.getMonth() === mesAtual && dataServico.getFullYear() === anoAtual;
            });
            
            const totalGabrielHoje = servicosGabrielHoje.reduce((sum, s) => sum + s.valor, 0);
            const totalGabrielMes = servicosGabrielMes.reduce((sum, s) => sum + s.valor, 0);
            const fiadoGabrielHoje = servicosGabrielHoje.filter(s => !s.pago).reduce((sum, s) => sum + s.valor, 0);
            const mediaGabriel = servicosGabrielHoje.length > 0 ? (totalGabrielHoje / servicosGabrielHoje.length) : 0;
            
            // Atualizar Gabriel
            document.getElementById('gabrielHoje').textContent = servicosGabrielHoje.length;
            document.getElementById('gabrielTotalHoje').textContent = `R$ ${totalGabrielHoje.toFixed(2)}`;
            document.getElementById('gabrielFiadoHoje').textContent = `R$ ${fiadoGabrielHoje.toFixed(2)}`;
            document.getElementById('gabrielMedia').textContent = `R$ ${mediaGabriel.toFixed(2)}`;
            
            // Wagner
            const servicosWagnerHoje = dados.Wagner.filter(s => s.data === hoje);
            const servicosWagnerMes = dados.Wagner.filter(s => {
                const dataServico = new Date(s.data);
                return dataServico.getMonth() === mesAtual && dataServico.getFullYear() === anoAtual;
            });
            
            const totalWagnerHoje = servicosWagnerHoje.reduce((sum, s) => sum + s.valor, 0);
            const totalWagnerMes = servicosWagnerMes.reduce((sum, s) => sum + s.valor, 0);
            const fiadoWagnerHoje = servicosWagnerHoje.filter(s => !s.pago).reduce((sum, s) => sum + s.valor, 0);
            const mediaWagner = servicosWagnerHoje.length > 0 ? (totalWagnerHoje / servicosWagnerHoje.length) : 0;
            
            // Atualizar Wagner
            document.getElementById('wagnerHoje').textContent = servicosWagnerHoje.length;
            document.getElementById('wagnerTotalHoje').textContent = `R$ ${totalWagnerHoje.toFixed(2)}`;
            document.getElementById('wagnerFiadoHoje').textContent = `R$ ${fiadoWagnerHoje.toFixed(2)}`;
            document.getElementById('wagnerMedia').textContent = `R$ ${mediaWagner.toFixed(2)}`;
            
            // Totais mensais
            const totalMes = totalGabrielMes + totalWagnerMes;
            const servicosMes = servicosGabrielMes.length + servicosWagnerMes.length;
            const fiadoMes = [...dados.Gabriel, ...dados.Wagner]
                .filter(s => {
                    const dataServico = new Date(s.data);
                    return dataServico.getMonth() === mesAtual && 
                           dataServico.getFullYear() === anoAtual && 
                           !s.pago;
                })
                .reduce((sum, s) => sum + s.valor, 0);
            
            // Despesas do m√™s
            const despesasMes = dados.despesas.filter(d => {
                const dataDespesa = new Date(d.data || d.dataCriacao);
                return dataDespesa.getMonth() === mesAtual && dataDespesa.getFullYear() === anoAtual;
            }).reduce((sum, d) => sum + d.valor, 0);
            
            document.getElementById('totalMes').textContent = `R$ ${totalMes.toFixed(2)}`;
            document.getElementById('servicosMes').textContent = servicosMes;
            document.getElementById('fiadoMes').textContent = `R$ ${fiadoMes.toFixed(2)}`;
            document.getElementById('despesasMes').textContent = `R$ ${despesasMes.toFixed(2)}`;
        }

        function atualizarEstatisticasGerais() {
            const hoje = new Date().toISOString().split('T')[0];
            const todosServicos = [...dados.Gabriel, ...dados.Wagner];
            const servicosHoje = todosServicos.filter(s => s.data === hoje);
            
            const totalHoje = servicosHoje.reduce((sum, s) => sum + s.valor, 0);
            const totalPago = servicosHoje.filter(s => s.pago).reduce((sum, s) => sum + s.valor, 0);
            const totalFiado = totalHoje - totalPago;
        }

        function atualizarResumoPagamentos() {
            const hoje = new Date().toISOString().split('T')[0];
            const todosServicos = [...dados.Gabriel, ...dados.Wagner];
            const servicosHoje = todosServicos.filter(s => s.data === hoje);
            
            // Calcular por m√©todo de pagamento
            const totalDinheiro = servicosHoje.filter(s => s.metodoPagamento === 'dinheiro').reduce((sum, s) => sum + s.valor, 0);
            const totalPix = servicosHoje.filter(s => s.metodoPagamento === 'pix').reduce((sum, s) => sum + s.valor, 0);
            const totalDebito = servicosHoje.filter(s => s.metodoPagamento === 'debito').reduce((sum, s) => sum + s.valor, 0);
            const totalCredito = servicosHoje.filter(s => s.metodoPagamento === 'credito').reduce((sum, s) => sum + s.valor, 0);
            
            document.getElementById('totalDinheiro').textContent = `R$ ${totalDinheiro.toFixed(2)}`;
            document.getElementById('totalPix').textContent = `R$ ${totalPix.toFixed(2)}`;
            document.getElementById('totalDebito').textContent = `R$ ${totalDebito.toFixed(2)}`;
            document.getElementById('totalCredito').textContent = `R$ ${totalCredito.toFixed(2)}`;
        }

        function atualizarGraficoPizza() {
            const hoje = new Date().toISOString().split('T')[0];
            
            const totalGabriel = dados.Gabriel.filter(s => s.data === hoje).reduce((sum, s) => sum + s.valor, 0);
            const totalWagner = dados.Wagner.filter(s => s.data === hoje).reduce((sum, s) => sum + s.valor, 0);
            const totalFiado = [...dados.Gabriel, ...dados.Wagner]
                .filter(s => s.data === hoje && !s.pago)
                .reduce((sum, s) => sum + s.valor, 0);
            
            if (graficoPizza) {
                graficoPizza.data.datasets[0].data = [totalGabriel, totalWagner, totalFiado];
                graficoPizza.update();
            }
        }

        function atualizarListaServicosRecentes() {
            const dataInicio = document.getElementById('dataInicioServicos').value;
            const dataFim = document.getElementById('dataFimServicos').value;
            const filtroBarbeiro = document.getElementById('filtroBarbeiroServicos').value;
            const filtroPagamento = document.getElementById('filtroPagamentoServicos').value;
            
            let todosServicos = [...dados.Gabriel, ...dados.Wagner];
            
            // Aplicar filtros
            todosServicos = todosServicos.filter(servico => {
                // Filtro por data
                if (servico.data < dataInicio || servico.data > dataFim) return false;
                
                // Filtro por barbeiro
                if (filtroBarbeiro !== 'todos' && servico.barbeiro !== filtroBarbeiro) return false;
                
                // Filtro por pagamento
                if (filtroPagamento === 'pago' && !servico.pago) return false;
                if (filtroPagamento === 'fiado' && servico.pago) return false;
                
                return true;
            });
            
            // Ordenar por data e hora (mais recente primeiro)
            todosServicos.sort((a, b) => {
                const dataA = new Date(a.data + 'T' + a.hora);
                const dataB = new Date(b.data + 'T' + b.hora);
                return dataB - dataA;
            });
            
            // Calcular totais filtrados
            const totalFiltrado = todosServicos.reduce((sum, s) => sum + s.valor, 0);
            const totalPagoFiltrado = todosServicos.filter(s => s.pago).reduce((sum, s) => sum + s.valor, 0);
            
            let html = '';
            
            if (todosServicos.length > 0) {
                html = `
                    <div style="background: rgba(255,255,255,0.03); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; text-align: center;">
                            <div>
                                <div style="font-size: 12px; color: #aaa;">TOTAL FILTRADO</div>
                                <div style="font-size: 24px; font-weight: 700; color: #ffaa00;">R$ ${totalFiltrado.toFixed(2)}</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #aaa;">SERVI√áOS</div>
                                <div style="font-size: 24px; font-weight: 700; color: #fff;">${todosServicos.length}</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #aaa;">RECEBIDO</div>
                                <div style="font-size: 20px; font-weight: 600; color: #25D366;">R$ ${totalPagoFiltrado.toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>üìÖ Data</th>
                                <th>‚è∞ Hora</th>
                                <th>üë§ Barbeiro</th>
                                <th>‚úÇÔ∏è Servi√ßo</th>
                                <th>üë§ Cliente</th>
                                <th>üí∞ Valor</th>
                                <th>üí≥ Pagamento</th>
                                <th>üìä Status</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                todosServicos.slice(0, 50).forEach(servico => {
                    const statusClass = servico.pago ? 'status-pago' : 'status-pendente';
                    const statusTexto = servico.pago ? 'PAGO' : 'FIADO';
                    const metodoPagamento = servico.metodoPagamento || 'N/A';
                    
                    let metodoIcon = 'üí∞';
                    switch(metodoPagamento) {
                        case 'dinheiro': metodoIcon = 'üíµ'; break;
                        case 'pix': metodoIcon = 'üì±'; break;
                        case 'debito': metodoIcon = 'üí≥'; break;
                        case 'credito': metodoIcon = 'üí≥'; break;
                    }
                    
                    html += `
                        <tr>
                            <td>${formatarDataBR(servico.data)}</td>
                            <td>${servico.hora}</td>
                            <td>
                                <span class="badge ${servico.barbeiro === 'Gabriel' ? 'badge-warning' : 'badge-success'}">
                                    ${servico.barbeiro}
                                </span>
                            </td>
                            <td>${servico.tipo}</td>
                            <td>${servico.cliente}</td>
                            <td style="font-weight: 600; color: #ffaa00;">R$ ${servico.valor.toFixed(2)}</td>
                            <td>${metodoIcon} ${metodoPagamento.toUpperCase()}</td>
                            <td><span class="status-tag ${statusClass}">${statusTexto}</span></td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                    
                    <div style="text-align: center; margin-top: 20px; color: #aaa; font-size: 14px;">
                        Mostrando ${Math.min(todosServicos.length, 50)} de ${todosServicos.length} servi√ßos
                        ${todosServicos.length > 50 ? '(use filtros para ver mais)' : ''}
                    </div>
                `;
            } else {
                html = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;">üìù</div>
                        <div style="color: #666; font-size: 18px; margin-bottom: 10px;">
                            Nenhum servi√ßo encontrado
                        </div>
                        <div style="color: #888; font-size: 14px;">
                            Tente ajustar os filtros ou datas
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('listaServicosRecentes').innerHTML = html;
        }

        function atualizarListaMensalistasDashboard() {
            const dataInicio = document.getElementById('dataInicioMensalistas').value;
            const dataFim = document.getElementById('dataFimMensalistas').value;
            const filtroStatus = document.getElementById('filtroStatusMensalistas').value;
            const filtroBarbeiro = document.getElementById('filtroBarbeiroMensalistas').value;
            
            let mensalistasFiltrados = dados.mensalistas.filter(mensalista => {
                const dataVenc = new Date(mensalista.dataVencimento || mensalista.vencimento || mensalista.dataInicio);
                const dataInicioDate = new Date(dataInicio);
                const dataFimDate = new Date(dataFim);
                
                if (dataVenc < dataInicioDate || dataVenc > dataFimDate) return false;
                if (filtroStatus !== 'todos' && mensalista.status !== filtroStatus) return false;
                if (filtroBarbeiro !== 'todos' && mensalista.barbeiro !== filtroBarbeiro) return false;
                
                return true;
            }).sort((a, b) => {
                const dataA = new Date(a.dataVencimento || a.vencimento || a.dataInicio);
                const dataB = new Date(b.dataVencimento || b.vencimento || b.dataInicio);
                return dataA - dataB;
            });
            
            // Verificar vencimentos pr√≥ximos
            const hoje = new Date();
            const notificacoes = mensalistasFiltrados.filter(m => {
                const dataVencimento = new Date(m.dataVencimento || m.vencimento);
                const diffDias = Math.ceil((dataVencimento - hoje) / (1000 * 60 * 60 * 24));
                return diffDias <= 3 && diffDias >= 0 && m.status !== 'pago';
            });
            
            let notificacoesHTML = '';
            if (notificacoes.length > 0) {
                notificacoesHTML = `
                    <div class="notificacao">
                        <div class="notificacao-titulo">‚ö†Ô∏è VENCIMENTOS PR√ìXIMOS</div>
                        <div style="display: grid; gap: 10px;">
                            ${notificacoes.map(m => {
                                const dataVencimento = new Date(m.dataVencimento || m.vencimento);
                                const diffDias = Math.ceil((dataVencimento - hoje) / (1000 * 60 * 60 * 24));
                                return `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,51,102,0.1); border-radius: 8px;">
                                        <div>
                                            <div style="font-weight: 600;">${m.nome}</div>
                                            <div style="font-size: 12px; color: #ff6666;">
                                                Vence em ${diffDias} ${diffDias === 1 ? 'dia' : 'dias'} - ${formatarDataBR(m.dataVencimento || m.vencimento)}
                                            </div>
                                        </div>
                                        <div>
                                            <div style="font-weight: 700; color: #ffaa00;">R$ ${m.valor.toFixed(2)}</div>
                                            <button class="action-btn success" onclick="pagarMensalidade(${m.id})" data-tooltip="Pagar mensalidade">
                                                üí∞
                                            </button>
                                            <button class="action-btn" onclick="enviarLembreteMensalista(${m.id})" data-tooltip="Enviar lembrete">
                                                üì±
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('notificacoesVencimento').innerHTML = notificacoesHTML;
            
            let html = '';
            if (mensalistasFiltrados.length > 0) {
                html = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 20px;">
                `;
                
                mensalistasFiltrados.forEach(mensalista => {
                    const statusClass = mensalista.status === 'pago' ? 'status-pago' : 
                                      mensalista.status === 'pendente' ? 'status-pendente' : 'status-vencido';
                    const statusTexto = mensalista.status === 'pago' ? '‚úÖ PAGO' : 
                                       mensalista.status === 'pendente' ? '‚è≥ PENDENTE' : '‚ö†Ô∏è VENCIDO';
                    
                    const dataVencimento = mensalista.dataVencimento || mensalista.vencimento;
                    const hoje = new Date();
                    const vencimento = new Date(dataVencimento);
                    const diasAteVencimento = Math.ceil((vencimento - hoje) / (1000 * 60 * 60 * 24));
                    
                    let vencimentoTexto = '';
                    if (mensalista.status === 'pago') {
                        vencimentoTexto = `üìÖ Pr√≥ximo vencimento: ${formatarDataBR(calcularProximoVencimento(dataVencimento))}`;
                    } else if (diasAteVencimento > 0) {
                        vencimentoTexto = `üìÖ Vence em ${diasAteVencimento} ${diasAteVencimento === 1 ? 'dia' : 'dias'}`;
                    } else if (diasAteVencimento === 0) {
                        vencimentoTexto = '‚ö†Ô∏è Vence hoje!';
                    } else {
                        vencimentoTexto = `‚è∞ Vencido h√° ${Math.abs(diasAteVencimento)} ${Math.abs(diasAteVencimento) === 1 ? 'dia' : 'dias'}`;
                    }
                    
                    html += `
                        <div class="mensalista-card">
                            <div class="mensalista-header">
                                <div class="mensalista-nome">${mensalista.nome}</div>
                                <div class="mensalista-actions">
                                    <span class="status-tag ${statusClass}">${statusTexto}</span>
                                    ${mensalista.status !== 'pago' ? `
                                        <button class="action-btn success" onclick="pagarMensalidade(${mensalista.id})" data-tooltip="Pagar mensalidade">
                                            üí∞
                                        </button>
                                    ` : ''}
                                    <button class="action-btn" onclick="enviarLembreteMensalista(${mensalista.id})" data-tooltip="Enviar lembrete">
                                        üì±
                                    </button>
                                    <button class="action-btn" onclick="removerMensalista(${mensalista.id})" data-tooltip="Remover mensalista" style="background: rgba(255,0,0,0.2); color: #ff0000;">
                                        √ó
                                    </button>
                                </div>
                            </div>
                            <div class="mensalista-detalhes">
                                <div class="mensalista-detalhes-item">
                                    <div class="mensalista-detalhes-label">Barbeiro</div>
                                    <div class="mensalista-detalhes-value">${mensalista.barbeiro || 'N/A'}</div>
                                </div>
                                <div class="mensalista-detalhes-item">
                                    <div class="mensalista-detalhes-label">Valor Mensal</div>
                                    <div class="mensalista-valor">R$ ${mensalista.valor.toFixed(2)}</div>
                                </div>
                                <div class="mensalista-detalhes-item">
                                    <div class="mensalista-detalhes-label">Vencimento</div>
                                    <div class="mensalista-detalhes-value">${formatarDataBR(dataVencimento)}</div>
                                </div>
                                ${mensalista.telefone ? `
                                    <div class="mensalista-detalhes-item">
                                        <div class="mensalista-detalhes-label">Telefone</div>
                                        <div class="mensalista-telefone">${mensalista.telefone}</div>
                                    </div>
                                ` : ''}
                            </div>
                            <div style="font-size: 12px; color: #aaa; margin-top: 10px;">
                                ${vencimentoTexto}
                            </div>
                            ${mensalista.observacoes ? `
                                <div style="font-size: 12px; color: #888; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1);">
                                    üìù ${mensalista.observacoes}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                html += `</div>`;
            } else {
                html = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;">üë•</div>
                        <div style="color: #666; font-size: 18px; margin-bottom: 10px;">
                            Nenhum mensalista encontrado
                        </div>
                        <div style="color: #888; font-size: 14px;">
                            Tente ajustar os filtros ou cadastre um novo mensalista
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('listaMensalistasDashboard').innerHTML = html;
        }

        // ========== FUN√á√ïES DOS MODAIS ==========
        function abrirModalResumoCompleto() {
            document.getElementById('modalResumo').style.display = 'flex';
            exibirResumoCompleto();
        }

        function exibirResumoCompleto() {
            const hoje = new Date();
            const mesAtual = hoje.getMonth();
            const anoAtual = hoje.getFullYear();
            
            // Calcular totais Gabriel
            const servicosGabrielMes = dados.Gabriel.filter(s => {
                const dataServico = new Date(s.data);
                return dataServico.getMonth() === mesAtual && dataServico.getFullYear() === anoAtual;
            });
            
            const totalGabriel = servicosGabrielMes.reduce((sum, s) => sum + s.valor, 0);
            const fiadoGabriel = servicosGabrielMes.filter(s => !s.pago).reduce((sum, s) => sum + s.valor, 0);
            const pagoGabriel = totalGabriel - fiadoGabriel;
            const mediaGabriel = servicosGabrielMes.length > 0 ? (totalGabriel / servicosGabrielMes.length) : 0;
            
            // Calcular totais Wagner
            const servicosWagnerMes = dados.Wagner.filter(s => {
                const dataServico = new Date(s.data);
                return dataServico.getMonth() === mesAtual && dataServico.getFullYear() === anoAtual;
            });
            
            const totalWagner = servicosWagnerMes.reduce((sum, s) => sum + s.valor, 0);
            const fiadoWagner = servicosWagnerMes.filter(s => !s.pago).reduce((sum, s) => sum + s.valor, 0);
            const pagoWagner = totalWagner - fiadoWagner;
            const mediaWagner = servicosWagnerMes.length > 0 ? (totalWagner / servicosWagnerMes.length) : 0;
            
            // Totais gerais
            const totalMes = totalGabriel + totalWagner;
            const totalFiado = fiadoGabriel + fiadoWagner;
            const totalPago = pagoGabriel + pagoWagner;
            const totalServicos = servicosGabrielMes.length + servicosWagnerMes.length;
            
            // M√©todos de pagamento
            const servicosMes = [...servicosGabrielMes, ...servicosWagnerMes];
            const porMetodo = {
                dinheiro: servicosMes.filter(s => s.metodoPagamento === 'dinheiro').reduce((sum, s) => sum + s.valor, 0),
                pix: servicosMes.filter(s => s.metodoPagamento === 'pix').reduce((sum, s) => sum + s.valor, 0),
                debito: servicosMes.filter(s => s.metodoPagamento === 'debito').reduce((sum, s) => sum + s.valor, 0),
                credito: servicosMes.filter(s => s.metodoPagamento === 'credito').reduce((sum, s) => sum + s.valor, 0)
            };
            
            const html = `
                <div style="background: linear-gradient(135deg, rgba(255,170,0,0.1), rgba(51,102,255,0.1)); border-radius: 15px; padding: 25px; margin-bottom: 25px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 24px; font-weight: 800; color: #ffaa00;">üìä RESUMO DO M√äS</div>
                        <div style="color: #aaa; font-size: 14px;">${hoje.toLocaleDateString('pt-BR', {month: 'long', year: 'numeric'}).toUpperCase()}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px;">
                        <div style="text-align: center;">
                            <div style="font-size: 12px; color: #aaa;">TOTAL GABRIEL</div>
                            <div style="font-size: 32px; font-weight: 800; color: #ffaa00; margin: 10px 0;">R$ ${totalGabriel.toFixed(2)}</div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 12px;">
                                <div>
                                    <div style="color: #25D366;">‚úÖ R$ ${pagoGabriel.toFixed(2)}</div>
                                    <div>Recebido</div>
                                </div>
                                <div>
                                    <div style="color: #FF9500;">‚è≥ R$ ${fiadoGabriel.toFixed(2)}</div>
                                    <div>Fiado</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <div style="font-size: 12px; color: #aaa;">TOTAL WAGNER</div>
                            <div style="font-size: 32px; font-weight: 800; color: #3366ff; margin: 10px 0;">R$ ${totalWagner.toFixed(2)}</div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 12px;">
                                <div>
                                    <div style="color: #25D366;">‚úÖ R$ ${pagoWagner.toFixed(2)}</div>
                                    <div>Recebido</div>
                                </div>
                                <div>
                                    <div style="color: #FF9500;">‚è≥ R$ ${fiadoWagner.toFixed(2)}</div>
                                    <div>Fiado</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; text-align: center;">
                        <div>
                            <div style="font-size: 12px; color: #aaa;">TOTAL GERAL</div>
                            <div style="font-size: 18px; font-weight: 700; color: #25D366;">R$ ${totalMes.toFixed(2)}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #aaa;">SERVI√áOS</div>
                            <div style="font-size: 18px; font-weight: 700; color: #fff;">${totalServicos}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #aaa;">M√âDIA/SERVI√áO</div>
                            <div style="font-size: 18px; font-weight: 700; color: #ffaa00;">R$ ${(totalMes / totalServicos || 0).toFixed(2)}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #aaa;">% FIADO</div>
                            <div style="font-size: 18px; font-weight: 700; color: ${totalFiado > totalMes * 0.3 ? '#ff3366' : '#FF9500'};">${totalMes > 0 ? ((totalFiado / totalMes) * 100).toFixed(1) : '0'}%</div>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px;">
                    <!-- M√©todos de Pagamento -->
                    <div>
                        <div style="color: #ffaa00; font-weight: 700; margin-bottom: 15px; font-size: 16px;">üí≥ M√âTODOS DE PAGAMENTO</div>
                        ${Object.entries(porMetodo).map(([metodo, valor]) => `
                            <div style="background: rgba(255,255,255,0.03); border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: 600;">${metodo.toUpperCase()}</div>
                                        <div style="font-size: 12px; color: #aaa;">${((valor / totalMes) * 100 || 0).toFixed(1)}% do total</div>
                                    </div>
                                    <div style="font-weight: 700; color: #25D366;">R$ ${valor.toFixed(2)}</div>
                                </div>
                                <div style="width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-top: 8px;">
                                    <div style="width: ${((valor / totalMes) * 100 || 0).toFixed(1)}%; height: 100%; background: linear-gradient(90deg, #ffaa00, #ff7733); border-radius: 3px;"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Tipos de Servi√ßo -->
                    <div>
                        <div style="color: #ffaa00; font-weight: 700; margin-bottom: 15px; font-size: 16px;">‚úÇÔ∏è TIPOS DE SERVI√áO</div>
                        <div style="background: rgba(255,255,255,0.03); border-radius: 10px; padding: 15px;">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 14px; color: #aaa;">CORTES</div>
                                    <div style="font-size: 20px; font-weight: 700; color: #ffaa00;">${servicosMes.filter(s => s.tipo === 'Corte').length}</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 14px; color: #aaa;">BARBAS</div>
                                    <div style="font-size: 20px; font-weight: 700; color: #3366ff;">${servicosMes.filter(s => s.tipo === 'Barba').length}</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 14px; color: #aaa;">COMBOS</div>
                                    <div style="font-size: 20px; font-weight: 700; color: #9933ff;">${servicosMes.filter(s => s.tipo === 'Barba + Cabelo').length}</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 14px; color: #aaa;">OUTROS</div>
                                    <div style="font-size: 20px; font-weight: 700; color: #25D366;">${servicosMes.filter(s => s.tipo === 'Outro').length}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Desempenho Barbeiros -->
                <div style="margin-top: 30px;">
                    <div style="color: #ffaa00; font-weight: 700; margin-bottom: 15px; font-size: 16px;">üë®‚Äçü¶± DESEMPENHO DOS BARBEIROS</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                        <div style="background: rgba(255,170,0,0.05); border-radius: 15px; padding: 20px;">
                            <div style="color: #ffaa00; font-weight: 700; margin-bottom: 10px;">GABRIEL</div>
                            <div style="font-size: 14px; margin-bottom: 8px;">Servi√ßos realizados: <strong>${servicosGabrielMes.length}</strong></div>
                            <div style="font-size: 14px; margin-bottom: 8px;">M√©dia por servi√ßo: <strong style="color: #ffaa00;">R$ ${mediaGabriel.toFixed(2)}</strong></div>
                            <div style="font-size: 14px; margin-bottom: 8px;">Dias trabalhados: <strong>${new Set(servicosGabrielMes.map(s => s.data)).size}</strong></div>
                            <div style="font-size: 14px;">M√©dia di√°ria: <strong style="color: #25D366;">R$ ${(totalGabriel / (new Set(servicosGabrielMes.map(s => s.data)).size || 1)).toFixed(2)}</strong></div>
                        </div>
                        
                        <div style="background: rgba(51,102,255,0.05); border-radius: 15px; padding: 20px;">
                            <div style="color: #3366ff; font-weight: 700; margin-bottom: 10px;">WAGNER</div>
                            <div style="font-size: 14px; margin-bottom: 8px;">Servi√ßos realizados: <strong>${servicosWagnerMes.length}</strong></div>
                            <div style="font-size: 14px; margin-bottom: 8px;">M√©dia por servi√ßo: <strong style="color: #3366ff;">R$ ${mediaWagner.toFixed(2)}</strong></div>
                            <div style="font-size: 14px; margin-bottom: 8px;">Dias trabalhados: <strong>${new Set(servicosWagnerMes.map(s => s.data)).size}</strong></div>
                            <div style="font-size: 14px;">M√©dia di√°ria: <strong style="color: #25D366;">R$ ${(totalWagner / (new Set(servicosWagnerMes.map(s => s.data)).size || 1)).toFixed(2)}</strong></div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('conteudoResumo').innerHTML = html;
        }

        function abrirModalPagamentos() {
            document.getElementById('modalPagamentos').style.display = 'flex';
            gerarRelatorioPagamentosDetalhado();
        }

        function gerarRelatorioPagamentosDetalhado() {
            const dataInicio = document.getElementById('dataInicioPagamentos').value;
            const dataFim = document.getElementById('dataFimPagamentos').value;
            const filtroBarbeiro = document.getElementById('filtroBarbeiroPagamentos').value;
            
            // Coletar servi√ßos no per√≠odo
            let todosServicos = [...dados.Gabriel, ...dados.Wagner].filter(s => {
                return s.data >= dataInicio && s.data <= dataFim;
            });
            
            if (filtroBarbeiro !== 'todos') {
                todosServicos = todosServicos.filter(s => s.barbeiro === filtroBarbeiro);
            }
            
            // Agrupar por barbeiro
            const porBarbeiro = {
                Gabriel: { total: 0, servicos: 0, pago: 0, fiado: 0, metodos: {} },
                Wagner: { total: 0, servicos: 0, pago: 0, fiado: 0, metodos: {} }
            };
            
            // Agrupar por m√©todo de pagamento
            const porMetodo = {
                dinheiro: { total: 0, servicos: 0 },
                pix: { total: 0, servicos: 0 },
                debito: { total: 0, servicos: 0 },
                credito: { total: 0, servicos: 0 }
            };
            
            // Agrupar por dia
            const porDia = {};
            
            todosServicos.forEach(servico => {
                // Por barbeiro
                if (porBarbeiro[servico.barbeiro]) {
                    porBarbeiro[servico.barbeiro].total += servico.valor;
                    porBarbeiro[servico.barbeiro].servicos += 1;
                    if (servico.pago) {
                        porBarbeiro[servico.barbeiro].pago += servico.valor;
                    } else {
                        porBarbeiro[servico.barbeiro].fiado += servico.valor;
                    }
                    
                    // M√©todos por barbeiro
                    if (!porBarbeiro[servico.barbeiro].metodos[servico.metodoPagamento]) {
                        porBarbeiro[servico.barbeiro].metodos[servico.metodoPagamento] = 0;
                    }
                    porBarbeiro[servico.barbeiro].metodos[servico.metodoPagamento] += servico.valor;
                }
                
                // Por m√©todo
                if (porMetodo[servico.metodoPagamento]) {
                    porMetodo[servico.metodoPagamento].total += servico.valor;
                    porMetodo[servico.metodoPagamento].servicos += 1;
                }
                
                // Por dia
                if (!porDia[servico.data]) {
                    porDia[servico.data] = { total: 0, servicos: 0, gabriel: 0, wagner: 0 };
                }
                porDia[servico.data].total += servico.valor;
                porDia[servico.data].servicos += 1;
                if (servico.barbeiro === 'Gabriel') {
                    porDia[servico.data].gabriel += servico.valor;
                } else {
                    porDia[servico.data].wagner += servico.valor;
                }
            });
            
            // Calcular totais
            const totalPeriodo = todosServicos.reduce((sum, s) => sum + s.valor, 0);
            const totalPago = todosServicos.filter(s => s.pago).reduce((sum, s) => sum + s.valor, 0);
            const totalFiado = totalPeriodo - totalPago;
            
            // Gerar HTML
            let html = `
                <div style="background: linear-gradient(135deg, rgba(255,170,0,0.1), rgba(51,102,255,0.1)); border-radius: 15px; padding: 25px; margin-bottom: 25px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 20px; font-weight: 800; color: #ffaa00;">üí∞ RELAT√ìRIO DE PAGAMENTOS</div>
                        <div style="color: #aaa; font-size: 14px;">${formatarDataBR(dataInicio)} √† ${formatarDataBR(dataFim)}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; text-align: center; margin-bottom: 20px;">
                        <div>
                            <div style="font-size: 12px; color: #aaa;">TOTAL PER√çODO</div>
                            <div style="font-size: 24px; font-weight: 800; color: #25D366;">R$ ${totalPeriodo.toFixed(2)}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #aaa;">SERVI√áOS</div>
                            <div style="font-size: 24px; font-weight: 800; color: #fff;">${todosServicos.length}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #aaa;">RECEBIDO</div>
                            <div style="font-size: 20px; font-weight: 700; color: #25D366;">R$ ${totalPago.toFixed(2)}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #aaa;">FIADO</div>
                            <div style="font-size: 20px; font-weight: 700; color: #FF9500;">R$ ${totalFiado.toFixed(2)}</div>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; margin-bottom: 30px;">
                    <!-- Por Barbeiro -->
                    <div>
                        <div style="color: #ffaa00; font-weight: 700; margin-bottom: 15px; font-size: 16px;">üë®‚Äçü¶± POR BARBEIRO</div>
                        ${Object.entries(porBarbeiro).filter(([_, dados]) => dados.servicos > 0).map(([barbeiro, dados]) => `
                            <div style="background: rgba(255,255,255,0.03); border-radius: 10px; padding: 20px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <div style="font-weight: 700; color: ${barbeiro === 'Gabriel' ? '#ffaa00' : '#3366ff'};">${barbeiro}</div>
                                    <div>
                                        <div style="font-size: 20px; font-weight: 800; color: #25D366;">R$ ${dados.total.toFixed(2)}</div>
                                        <div style="font-size: 12px; color: #aaa; text-align: right;">${dados.servicos} servi√ßos</div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                                    <div>
                                        <div style="font-size: 12px; color: #aaa;">Recebido</div>
                                        <div style="font-weight: 600; color: #25D366;">R$ ${dados.pago.toFixed(2)}</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 12px; color: #aaa;">Fiado</div>
                                        <div style="font-weight: 600; color: #FF9500;">R$ ${dados.fiado.toFixed(2)}</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Por M√©todo -->
                    <div>
                        <div style="color: #ffaa00; font-weight: 700; margin-bottom: 15px; font-size: 16px;">üí≥ POR M√âTODO</div>
                        ${Object.entries(porMetodo).filter(([_, dados]) => dados.servicos > 0).map(([metodo, dados]) => `
                            <div style="background: rgba(255,255,255,0.03); border-radius: 10px; padding: 20px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div style="font-weight: 700; color: #fff;">${metodo.toUpperCase()}</div>
                                    <div>
                                        <div style="font-size: 20px; font-weight: 800; color: #25D366;">R$ ${dados.total.toFixed(2)}</div>
                                        <div style="font-size: 12px; color: #aaa; text-align: right;">${dados.servicos} servi√ßos</div>
                                    </div>
                                </div>
                                <div style="width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px;">
                                    <div style="width: ${((dados.total / totalPeriodo) * 100 || 0).toFixed(1)}%; height: 100%; background: linear-gradient(90deg, #ffaa00, #ff7733); border-radius: 3px;"></div>
                                </div>
                                <div style="font-size: 12px; color: #aaa; margin-top: 8px; text-align: right;">
                                    ${((dados.total / totalPeriodo) * 100 || 0).toFixed(1)}% do total
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Adicionar se√ß√£o por dia se houver dados
            if (Object.keys(porDia).length > 0) {
                const diasOrdenados = Object.keys(porDia).sort();
                
                html += `
                    <div style="color: #ffaa00; font-weight: 700; margin-bottom: 15px; font-size: 16px;">üìÖ EVOLU√á√ÉO POR DIA</div>
                    <div style="background: rgba(255,255,255,0.03); border-radius: 10px; padding: 20px;">
                        <table style="width: 100%;">
                            <thead>
                                <tr>
                                    <th style="text-align: left;">Data</th>
                                    <th style="text-align: right;">Servi√ßos</th>
                                    <th style="text-align: right;">Gabriel</th>
                                    <th style="text-align: right;">Wagner</th>
                                    <th style="text-align: right;">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${diasOrdenados.map(data => `
                                    <tr>
                                        <td>${formatarDataBR(data)}</td>
                                        <td style="text-align: right;">${porDia[data].servicos}</td>
                                        <td style="text-align: right; color: #ffaa00;">R$ ${porDia[data].gabriel.toFixed(2)}</td>
                                        <td style="text-align: right; color: #3366ff;">R$ ${porDia[data].wagner.toFixed(2)}</td>
                                        <td style="text-align: right; font-weight: 700; color: #25D366;">R$ ${porDia[data].total.toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            document.getElementById('relatorioPagamentosDetalhado').innerHTML = html;
            
            // Armazenar dados para envio
            window.relatorioAtual = {
                dataInicio,
                dataFim,
                filtroBarbeiro,
                porBarbeiro,
                porMetodo,
                porDia,
                totalPeriodo,
                totalPago,
                totalFiado,
                totalServicos: todosServicos.length
            };
        }

        function abrirModalMensalistas() {
            document.getElementById('modalMensalistas').style.display = 'flex';
            listarMensalistasModal();
        }

 function listarMensalistasModal() {
    const mensalistas = [...dados.mensalistas].sort((a, b) => {
        const nomeA = a.nome.toUpperCase();
        const nomeB = b.nome.toUpperCase();
        return nomeA.localeCompare(nomeB);
    });

    let html = '<div class="card">';
    html += '<div class="card-header"><div class="card-title">üìã TODOS OS MENSALISTAS</div>';
    html += '<div class="badge badge-success">' + mensalistas.length + ' cadastrados</div></div>';
    
    if (mensalistas.length > 0) {
        html += '<div style="overflow-x: auto;"><table>';
        html += `
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Barbeiro</th>
                    <th>Valor</th>
                    <th>Vencimento</th>
                    <th>Status</th>
                    <th>Telefone</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
        `;
        
        mensalistas.forEach(mensalista => {
            const statusClass = mensalista.status === 'pago' ? 'status-pago' : 
                              mensalista.status === 'pendente' ? 'status-pendente' : 'status-vencido';
            const statusTexto = mensalista.status === 'pago' ? '‚úÖ PAGO' : 
                               mensalista.status === 'pendente' ? '‚è≥ PENDENTE' : '‚ö†Ô∏è VENCIDO';
            
            html += `
                <tr>
                    <td><strong>${mensalista.nome}</strong></td>
                    <td><span class="badge ${mensalista.barbeiro === 'Gabriel' ? 'badge-warning' : 'badge-success'}">${mensalista.barbeiro}</span></td>
                    <td style="font-weight: 700; color: #00cc99;">R$ ${mensalista.valor.toFixed(2)}</td>
                    <td>${formatarDataBR(mensalista.dataVencimento || mensalista.vencimento)}</td>
                    <td><span class="status-tag ${statusClass}">${statusTexto}</span></td>
                    <td>${mensalista.telefone || '‚Äî'}</td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <button class="action-btn success" onclick="pagarMensalidade(${mensalista.id})" data-tooltip="Pagar">
                                üí∞
                            </button>
                            <button class="action-btn" onclick="editarMensalista(${mensalista.id})" data-tooltip="Editar">
                                ‚úèÔ∏è
                            </button>
                            <button class="action-btn" onclick="enviarLembreteMensalista(${mensalista.id})" data-tooltip="WhatsApp">
                                üì±
                            </button>
                            <button class="action-btn" onclick="removerMensalista(${mensalista.id})" data-tooltip="Remover" style="background: rgba(255,0,0,0.2); color: #ff0000;">
                                √ó
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });
        
        html += '</tbody></table></div>';
    } else {
        html += `
            <div style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;">üë•</div>
                <div style="color: #666; font-size: 16px; margin-bottom: 10px;">
                    Nenhum mensalista cadastrado
                </div>
                <div style="color: #888; font-size: 14px;">
                    Clique em "Novo Mensalista" para come√ßar
                </div>
            </div>
        `;
    }
    
    html += '</div>';
    document.getElementById('listaMensalistasModal').innerHTML = html;
}

// ========== FUN√á√ïES DE MENSALISTAS ==========
function adicionarMensalista() {
    const nome = document.getElementById('nomeMensalista').value.trim();
    const telefone = document.getElementById('telefoneMensalista').value.trim();
    const barbeiro = document.getElementById('barbeiroMensalista').value;
    const valor = parseFloat(document.getElementById('valorMensalista').value);
    const dataInicio = document.getElementById('dataInicioMensalista').value;
    const diaVencimento = parseInt(document.getElementById('diaVencimentoMensalista').value);
    const status = document.getElementById('statusMensalista').value;
    const observacoes = document.getElementById('observacoesMensalista').value.trim();
    
    if (!nome || !barbeiro || isNaN(valor) || !dataInicio || !diaVencimento) {
        alert('‚ùå Preencha todos os campos obrigat√≥rios!');
        return;
    }
    
    // Gerar ID √∫nico
    const id = dados.mensalistas.length > 0 ? Math.max(...dados.mensalistas.map(m => m.id)) + 1 : 1;
    
    // Calcular data de vencimento
    const dataInicioObj = new Date(dataInicio);
    let dataVencimento = new Date(dataInicioObj.getFullYear(), dataInicioObj.getMonth(), diaVencimento);
    
    // Se o dia de vencimento for menor que o dia atual, vai para o pr√≥ximo m√™s
    if (dataVencimento < dataInicioObj) {
        dataVencimento = new Date(dataInicioObj.getFullYear(), dataInicioObj.getMonth() + 1, diaVencimento);
    }
    
    const novoMensalista = {
        id: id,
        nome: nome,
        telefone: telefone,
        barbeiro: barbeiro,
        valor: valor,
        dataInicio: dataInicio,
        diaVencimento: diaVencimento,
        dataVencimento: dataVencimento.toISOString().split('T')[0],
        status: status,
        observacoes: observacoes,
        historicoPagamentos: []
    };
    
    dados.mensalistas.push(novoMensalista);
    salvarDados();
    
    // Notificar via WebSocket
    if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({
            type: 'atualizar',
            mensagem: `Novo mensalista: ${nome}`
        }));
    }
    
    // Limpar formul√°rio
    limparFormMensalista();
    
    // Atualizar listas
    listarMensalistasModal();
    atualizarListaMensalistasDashboard();
    
    // Mostrar confirma√ß√£o
    alert(`‚úÖ Mensalista "${nome}" cadastrado com sucesso!`);
}

function limparFormMensalista() {
    document.getElementById('nomeMensalista').value = '';
    document.getElementById('telefoneMensalista').value = '';
    document.getElementById('valorMensalista').value = '';
    document.getElementById('observacoesMensalista').value = '';
    
    // Resetar valores padr√£o
    const hoje = new Date();
    document.getElementById('dataInicioMensalista').value = hoje.toISOString().split('T')[0];
    document.getElementById('diaVencimentoMensalista').value = hoje.getDate();
}

function pagarMensalidade(id) {
    const mensalista = dados.mensalistas.find(m => m.id === id);
    if (!mensalista) {
        alert('‚ùå Mensalista n√£o encontrado!');
        return;
    }
    
    const hoje = new Date();
    const valorPago = parseFloat(prompt(`üíµ Valor a pagar para ${mensalista.nome}:`, mensalista.valor));
    
    if (!valorPago || isNaN(valorPago) || valorPago <= 0) {
        alert('‚ùå Valor inv√°lido!');
        return;
    }
    
    // Registrar pagamento
    if (!mensalista.historicoPagamentos) {
        mensalista.historicoPagamentos = [];
    }
    
    mensalista.historicoPagamentos.push({
        data: hoje.toISOString().split('T')[0],
        valor: valorPago,
        pagoPor: 'Sistema'
    });
    
    // Atualizar status e calcular pr√≥ximo vencimento
    mensalista.status = 'pago';
    mensalista.dataUltimoPagamento = hoje.toISOString().split('T')[0];
    
    // Calcular pr√≥ximo vencimento
    const dataVencimentoAtual = new Date(mensalista.dataVencimento);
    const proximoVencimento = new Date(dataVencimentoAtual.getFullYear(), dataVencimentoAtual.getMonth() + 1, mensalista.diaVencimento);
    mensalista.dataVencimento = proximoVencimento.toISOString().split('T')[0];
    
    salvarDados();
    
    // Atualizar interface
    atualizarListaMensalistasDashboard();
    if (document.getElementById('modalMensalistas').style.display === 'flex') {
        listarMensalistasModal();
    }
    
    // Notificar via WebSocket
    if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({
            type: 'mensalista_pago',
            id: id,
            nome: mensalista.nome,
            valor: valorPago
        }));
    }
    
    alert(`‚úÖ Pagamento de R$ ${valorPago.toFixed(2)} registrado para ${mensalista.nome}!`);
}

function editarMensalista(id) {
    const mensalista = dados.mensalistas.find(m => m.id === id);
    if (!mensalista) {
        alert('‚ùå Mensalista n√£o encontrado!');
        return;
    }
    
    // Preencher modal com dados do mensalista
    document.getElementById('nomeMensalista').value = mensalista.nome;
    document.getElementById('telefoneMensalista').value = mensalista.telefone || '';
    document.getElementById('barbeiroMensalista').value = mensalista.barbeiro;
    document.getElementById('valorMensalista').value = mensalista.valor;
    document.getElementById('dataInicioMensalista').value = mensalista.dataInicio;
    document.getElementById('diaVencimentoMensalista').value = mensalista.diaVencimento;
    document.getElementById('statusMensalista').value = mensalista.status;
    document.getElementById('observacoesMensalista').value = mensalista.observacoes || '';
    
    // Mudar bot√£o para "Atualizar"
    const btnAdicionar = document.getElementById('btnAdicionarMensalista');
    const originalText = btnAdicionar.textContent;
    btnAdicionar.textContent = 'üíæ Atualizar Mensalista';
    
    btnAdicionar.onclick = function() {
        atualizarMensalista(id);
        btnAdicionar.textContent = originalText;
        btnAdicionar.onclick = adicionarMensalista;
    };
}

function atualizarMensalista(id) {
    const mensalista = dados.mensalistas.find(m => m.id === id);
    if (!mensalista) {
        alert('‚ùå Mensalista n√£o encontrado!');
        return;
    }
    
    const nome = document.getElementById('nomeMensalista').value.trim();
    const telefone = document.getElementById('telefoneMensalista').value.trim();
    const barbeiro = document.getElementById('barbeiroMensalista').value;
    const valor = parseFloat(document.getElementById('valorMensalista').value);
    const dataInicio = document.getElementById('dataInicioMensalista').value;
    const diaVencimento = parseInt(document.getElementById('diaVencimentoMensalista').value);
    const status = document.getElementById('statusMensalista').value;
    const observacoes = document.getElementById('observacoesMensalista').value.trim();
    
    if (!nome || !barbeiro || isNaN(valor) || !dataInicio || !diaVencimento) {
        alert('‚ùå Preencha todos os campos obrigat√≥rios!');
        return;
    }
    
    // Atualizar dados
    mensalista.nome = nome;
    mensalista.telefone = telefone;
    mensalista.barbeiro = barbeiro;
    mensalista.valor = valor;
    mensalista.dataInicio = dataInicio;
    mensalista.diaVencimento = diaVencimento;
    mensalista.status = status;
    mensalista.observacoes = observacoes;
    
    // Recalcular vencimento se necess√°rio
    if (diaVencimento !== mensalista.diaVencimento || dataInicio !== mensalista.dataInicio) {
        const dataInicioObj = new Date(dataInicio);
        let dataVencimento = new Date(dataInicioObj.getFullYear(), dataInicioObj.getMonth(), diaVencimento);
        
        if (dataVencimento < dataInicioObj) {
            dataVencimento = new Date(dataInicioObj.getFullYear(), dataInicioObj.getMonth() + 1, diaVencimento);
        }
        
        mensalista.dataVencimento = dataVencimento.toISOString().split('T')[0];
    }
    
    salvarDados();
    
    // Atualizar interface
    atualizarListaMensalistasDashboard();
    listarMensalistasModal();
    
    // Resetar formul√°rio
    limparFormMensalista();
    
    alert(`‚úÖ Mensalista "${nome}" atualizado com sucesso!`);
}

function removerMensalista(id) {
    if (!confirm('‚ö†Ô∏è Tem certeza que deseja remover este mensalista?')) {
        return;
    }
    
    const index = dados.mensalistas.findIndex(m => m.id === id);
    if (index === -1) {
        alert('‚ùå Mensalista n√£o encontrado!');
        return;
    }
    
    const nomeRemovido = dados.mensalistas[index].nome;
    dados.mensalistas.splice(index, 1);
    salvarDados();
    
    // Notificar via WebSocket
    if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({
            type: 'mensalista_removido',
            id: id,
            nome: nomeRemovido
        }));
    }
    
    // Atualizar interface
    atualizarListaMensalistasDashboard();
    if (document.getElementById('modalMensalistas').style.display === 'flex') {
        listarMensalistasModal();
    }
    
    alert(`üóëÔ∏è Mensalista "${nomeRemovido}" removido com sucesso!`);
}

function enviarLembreteMensalista(id) {
    const mensalista = dados.mensalistas.find(m => m.id === id);
    if (!mensalista) {
        alert('‚ùå Mensalista n√£o encontrado!');
        return;
    }
    
    if (!mensalista.telefone || mensalista.telefone.length < 11) {
        alert('‚ùå N√∫mero de telefone inv√°lido para envio de mensagem!');
        return;
    }
    
    const hoje = new Date();
    const dataVencimento = new Date(mensalista.dataVencimento);
    const diasAteVencimento = Math.ceil((dataVencimento - hoje) / (1000 * 60 * 60 * 24));
    
    let mensagem = '';
    if (mensalista.status === 'vencido') {
        mensagem = `*LEMBRETE MENSALIDADE VENCIDA*%0A%0A` +
                  `Ol√° ${mensalista.nome},%0A%0A` +
                  `Sua mensalidade est√° *VENCIDA*!%0A` +
                  `Valor: R$ ${mensalista.valor.toFixed(2)}%0A` +
                  `Vencimento: ${formatarDataBR(mensalista.dataVencimento)}%0A` +
                  `Barbeiro: ${mensalista.barbeiro}%0A%0A` +
                  `*Por favor, regularize o pagamento.*%0A%0A` +
                  `BarbaPRO Duo`;
    } else if (mensalista.status === 'pendente') {
        mensagem = `*LEMBRETE MENSALIDADE*%0A%0A` +
                  `Ol√° ${mensalista.nome},%0A%0A` +
                  `Lembrete da sua mensalidade:%0A` +
                  `Valor: R$ ${mensalista.valor.toFixed(2)}%0A` +
                  `Vencimento: ${formatarDataBR(mensalista.dataVencimento)}%0A` +
                  `Vence em: ${diasAteVencimento} ${diasAteVencimento === 1 ? 'dia' : 'dias'}%0A` +
                  `Barbeiro: ${mensalista.barbeiro}%0A%0A` +
                  `*Obrigado pela prefer√™ncia!*%0A%0A` +
                  `BarbaPRO Duo`;
    } else {
        mensagem = `*CONFIRMA√á√ÉO DE PAGAMENTO*%0A%0A` +
                  `Ol√° ${mensalista.nome},%0A%0A` +
                  `Pagamento confirmado!%0A` +
                  `Valor: R$ ${mensalista.valor.toFixed(2)}%0A` +
                  `Pr√≥ximo vencimento: ${formatarDataBR(mensalista.dataVencimento)}%0A` +
                  `Barbeiro: ${mensalista.barbeiro}%0A%0A` +
                  `*Obrigado pela prefer√™ncia!*%0A%0A` +
                  `BarbaPRO Duo`;
    }
    
    const telefoneFormatado = mensalista.telefone.replace(/\D/g, '');
    const urlWhatsApp = `https://wa.me/55${telefoneFormatado}?text=${mensagem}`;
    
    // Abrir em nova aba
    window.open(urlWhatsApp, '_blank');
}

function enviarLembretesMensalistas() {
    const hoje = new Date();
    const mensalistasPendentes = dados.mensalistas.filter(m => m.status === 'pendente' || m.status === 'vencido');
    
    if (mensalistasPendentes.length === 0) {
        alert('‚úÖ N√£o h√° mensalistas pendentes para enviar lembretes!');
        return;
    }
    
    if (!confirm(`üì± Enviar lembretes para ${mensalistasPendentes.length} mensalista(s)?`)) {
        return;
    }
    
    // Filtrar apenas os que t√™m telefone
    const mensalistasComTelefone = mensalistasPendentes.filter(m => m.telefone && m.telefone.length >= 11);
    
    if (mensalistasComTelefone.length === 0) {
        alert('‚ùå Nenhum mensalista com telefone v√°lido encontrado!');
        return;
    }
    
    // Criar lista para envio
    let contador = 0;
    const intervalo = setInterval(() => {
        if (contador < mensalistasComTelefone.length) {
            const mensalista = mensalistasComTelefone[contador];
            enviarLembreteMensalista(mensalista.id);
            contador++;
        } else {
            clearInterval(intervalo);
            alert(`‚úÖ Lembretes enviados para ${contador} mensalista(s)!`);
        }
    }, 2000); // Intervalo de 2 segundos entre envios
}

// ========== CONFIGURA√á√ïES ==========
function abrirModalConfiguracoes() {
    document.getElementById('modalConfig').style.display = 'flex';
    
    // Preencher valores atuais
    document.getElementById('numWhats').value = dados.config.whatsapp || '';
    document.getElementById('novoPin').value = '';
    document.getElementById('valCorte').value = dados.config.corte || 28;
    document.getElementById('valBarba').value = dados.config.barba || 15;
    document.getElementById('valCombo').value = dados.config.combo || 40;
}

function salvarConfiguracoes() {
    const whatsapp = document.getElementById('numWhats').value.trim();
    const novoPin = document.getElementById('novoPin').value.trim();
    const corte = parseFloat(document.getElementById('valCorte').value);
    const barba = parseFloat(document.getElementById('valBarba').value);
    const combo = parseFloat(document.getElementById('valCombo').value);
    
    // Validar valores
    if (whatsapp && !/^\d{10,15}$/.test(whatsapp.replace(/\D/g, ''))) {
        alert('‚ùå N√∫mero de WhatsApp inv√°lido!');
        return;
    }
    
    if (novoPin && !/^\d{4}$/.test(novoPin)) {
        alert('‚ùå PIN deve conter 4 d√≠gitos!');
        return;
    }
    
    if (isNaN(corte) || isNaN(barba) || isNaN(combo)) {
        alert('‚ùå Valores de servi√ßo inv√°lidos!');
        return;
    }
    
    // Atualizar configura√ß√µes
    if (whatsapp) dados.config.whatsapp = whatsapp;
    if (novoPin) dados.config.pin = novoPin;
    dados.config.corte = corte;
    dados.config.barba = barba;
    dados.config.combo = combo;
    
    salvarDados();
    
    // Fechar modal
    fecharModal('modalConfig');
    
    alert('‚úÖ Configura√ß√µes salvas com sucesso!');
}

// ========== FUN√á√ïES DE EXPORTA√á√ÉO ==========
function exportarDadosServicos() {
    const dataInicio = document.getElementById('dataInicioServicos').value;
    const dataFim = document.getElementById('dataFimServicos').value;
    const filtroBarbeiro = document.getElementById('filtroBarbeiroServicos').value;
    const filtroPagamento = document.getElementById('filtroPagamentoServicos').value;
    
    let servicos = [...dados.Gabriel, ...dados.Wagner].filter(s => {
        if (s.data < dataInicio || s.data > dataFim) return false;
        if (filtroBarbeiro !== 'todos' && s.barbeiro !== filtroBarbeiro) return false;
        if (filtroPagamento === 'pago' && !s.pago) return false;
        if (filtroPagamento === 'fiado' && s.pago) return false;
        return true;
    });
    
    // Converter para CSV
    let csv = 'Data,Hora,Barbeiro,Cliente,Servi√ßo,Valor,Status Pagamento,M√©todo Pagamento,Observa√ß√µes\n';
    
    servicos.forEach(s => {
        const linha = [
            s.data,
            s.hora,
            s.barbeiro,
            s.cliente,
            s.tipo,
            s.valor.toFixed(2),
            s.pago ? 'PAGO' : 'FIADO',
            s.metodoPagamento || 'N/A',
            s.observacoes || ''
        ].map(campo => `"${campo}"`).join(',');
        
        csv += linha + '\n';
    });
    
    // Criar arquivo e baixar
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    link.setAttribute('href', url);
    link.setAttribute('download', `servicos_${dataInicio}_a_${dataFim}.csv`);
    link.style.visibility = 'hidden';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    alert(`üì• Arquivo CSV gerado com ${servicos.length} servi√ßos!`);
}

// ========== FUN√á√ïES DE NOTIFICA√á√ÉO ==========
function verificarVencimentosMensalistas() {
    const hoje = new Date();
    hoje.setHours(0, 0, 0, 0);
    
    const vencidos = dados.mensalistas.filter(m => {
        const dataVencimento = new Date(m.dataVencimento);
        dataVencimento.setHours(0, 0, 0, 0);
        
        // Se estiver vencido e n√£o pago
        if (dataVencimento < hoje && m.status !== 'pago') {
            // Atualizar status se necess√°rio
            if (m.status !== 'vencido') {
                m.status = 'vencido';
            }
            return true;
        }
        
        // Se vence hoje
        if (dataVencimento.getTime() === hoje.getTime() && m.status !== 'pago') {
            if (m.status !== 'vencido') {
                m.status = 'pendente';
            }
            return false; // N√£o contar como vencido ainda
        }
        
        return false;
    });
    
    if (vencidos.length > 0) {
        // Salvar altera√ß√µes de status
        salvarDados();
        
        // Mostrar notifica√ß√£o visual
        const notificacao = document.createElement('div');
        notificacao.className = 'notificacao';
        notificacao.innerHTML = `
            <div class="notificacao-titulo">‚ö†Ô∏è ${vencidos.length} MENSALISTA(S) VENCIDO(S)</div>
            <div style="font-size: 14px; color: #ffcccc;">
                ${vencidos.slice(0, 3).map(m => m.nome).join(', ')}${vencidos.length > 3 ? ` e mais ${vencidos.length - 3}` : ''}
            </div>
            <button class="btn btn-danger" onclick="abrirModalMensalistas()" style="margin-top: 10px; width: 100%;">
                üëÅÔ∏è Ver Detalhes
            </button>
        `;
        
        // Adicionar no in√≠cio do dashboard
        const container = document.querySelector('.container');
        container.insertBefore(notificacao, container.firstChild);
        
        // Remover ap√≥s 10 segundos
        setTimeout(() => {
            if (notificacao.parentNode) {
                notificacao.style.opacity = '0';
                notificacao.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    if (notificacao.parentNode) {
                        notificacao.parentNode.removeChild(notificacao);
                    }
                }, 500);
            }
        }, 10000);
    }
}

function mostrarNotificacaoWebSocket(data) {
    const notificacao = document.createElement('div');
    notificacao.className = 'notificacao';
    notificacao.style.background = 'linear-gradient(135deg, rgba(37,211,102,0.1), rgba(37,211,102,0.05))';
    notificacao.style.border = '2px solid rgba(37,211,102,0.3)';
    
    notificacao.innerHTML = `
        <div style="color: #25D366; font-weight: 700; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
            üîî NOVA ATUALIZA√á√ÉO
        </div>
        <div style="font-size: 14px; color: #fff;">
            ${data.mensagem || 'Dados atualizados por outro dispositivo'}
        </div>
    `;
    
    // Adicionar no in√≠cio do dashboard
    const container = document.querySelector('.container');
    container.insertBefore(notificacao, container.firstChild);
    
    // Remover ap√≥s 5 segundos
    setTimeout(() => {
        if (notificacao.parentNode) {
            notificacao.style.opacity = '0';
            notificacao.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                if (notificacao.parentNode) {
                    notificacao.parentNode.removeChild(notificacao);
                }
            }, 500);
        }
    }, 5000);
}

// ========== FUN√á√ïES DE ENVIO WHATSAPP ==========
function enviarRelatorioWhatsApp(tipo) {
    const numero = dados.config.whatsapp || '11974065186';
    
    if (!numero || numero.length < 10) {
        alert('‚ùå Configure um n√∫mero de WhatsApp nas configura√ß√µes!');
        abrirModalConfiguracoes();
        return;
    }
    
    let mensagem = '';
    const hoje = new Date();
    
    switch(tipo) {
        case 'resumo':
            const mesAtual = hoje.getMonth();
            const anoAtual = hoje.getFullYear();
            
            const servicosGabriel = dados.Gabriel.filter(s => {
                const data = new Date(s.data);
                return data.getMonth() === mesAtual && data.getFullYear() === anoAtual;
            });
            const servicosWagner = dados.Wagner.filter(s => {
                const data = new Date(s.data);
                return data.getMonth() === mesAtual && data.getFullYear() === anoAtual;
            });
            
            const totalGabriel = servicosGabriel.reduce((s, v) => s + v.valor, 0);
            const totalWagner = servicosWagner.reduce((s, v) => s + v.valor, 0);
            const totalMes = totalGabriel + totalWagner;
            const totalServicos = servicosGabriel.length + servicosWagner.length;
            
            mensagem = `*üìä RESUMO MENSAL BARBAPRO DUO*%0A%0A` +
                      `Per√≠odo: ${hoje.toLocaleDateString('pt-BR', {month: 'long', year: 'numeric'})}%0A%0A` +
                      `*GABRIEL:*%0A` +
                      `Servi√ßos: ${servicosGabriel.length}%0A` +
                      `Total: R$ ${totalGabriel.toFixed(2)}%0A%0A` +
                      `*WAGNER:*%0A` +
                      `Servi√ßos: ${servicosWagner.length}%0A` +
                      `Total: R$ ${totalWagner.toFixed(2)}%0A%0A` +
                      `*TOTAL GERAL:*%0A` +
                      `Servi√ßos: ${totalServicos}%0A` +
                      `Faturamento: R$ ${totalMes.toFixed(2)}%0A%0A` +
                      `*BarbaPRO Duo*`;
            break;
            
        case 'pagamentos':
            if (!window.relatorioAtual) {
                alert('‚ùå Gere um relat√≥rio primeiro!');
                return;
            }
            
            const rel = window.relatorioAtual;
            mensagem = `*üí∞ RELAT√ìRIO DE PAGAMENTOS*%0A%0A` +
                      `Per√≠odo: ${formatarDataBR(rel.dataInicio)} √† ${formatarDataBR(rel.dataFim)}%0A` +
                      `Barbeiro: ${rel.filtroBarbeiro === 'todos' ? 'Todos' : rel.filtroBarbeiro}%0A%0A` +
                      `*RESUMO:*%0A` +
                      `Servi√ßos: ${rel.totalServicos}%0A` +
                      `Total: R$ ${rel.totalPeriodo.toFixed(2)}%0A` +
                      `Recebido: R$ ${rel.totalPago.toFixed(2)}%0A` +
                      `Fiado: R$ ${rel.totalFiado.toFixed(2)}%0A%0A`;
            
            // Adicionar por barbeiro
            if (rel.porBarbeiro.Gabriel.servicos > 0 || rel.porBarbeiro.Wagner.servicos > 0) {
                mensagem += `*POR BARBEIRO:*%0A`;
                Object.entries(rel.porBarbeiro).forEach(([barbeiro, dados]) => {
                    if (dados.servicos > 0) {
                        mensagem += `${barbeiro}: R$ ${dados.total.toFixed(2)} (${dados.servicos} servi√ßos)%0A`;
                    }
                });
                mensagem += `%0A`;
            }
            
            mensagem += `*BarbaPRO Duo*`;
            break;
            
        case 'servicos':
            const dataInicio = document.getElementById('dataInicioServicos').value;
            const dataFim = document.getElementById('dataFimServicos').value;
            
            const servicosFiltrados = [...dados.Gabriel, ...dados.Wagner].filter(s => 
                s.data >= dataInicio && s.data <= dataFim
            );
            
            const total = servicosFiltrados.reduce((s, v) => s + v.valor, 0);
            const pago = servicosFiltrados.filter(s => s.pago).reduce((s, v) => s + v.valor, 0);
            
            mensagem = `*üìù RELAT√ìRIO DE SERVI√áOS*%0A%0A` +
                      `Per√≠odo: ${formatarDataBR(dataInicio)} √† ${formatarDataBR(dataFim)}%0A` +
                      `Servi√ßos: ${servicosFiltrados.length}%0A` +
                      `Total: R$ ${total.toFixed(2)}%0A` +
                      `Recebido: R$ ${pago.toFixed(2)}%0A` +
                      `Fiado: R$ ${(total - pago).toFixed(2)}%0A%0A` +
                      `*BarbaPRO Duo*`;
            break;
    }
    
    const url = `https://wa.me/55${numero.replace(/\D/g, '')}?text=${mensagem}`;
    window.open(url, '_blank');
}

// ========== FUN√á√ïES AUXILIARES ==========
function formatarDataBR(dataString) {
    if (!dataString) return '';
    const date = new Date(dataString);
    return date.toLocaleDateString('pt-BR');
}

function calcularProximoVencimento(dataVencimento) {
    const data = new Date(dataVencimento);
    data.setMonth(data.getMonth() + 1);
    return data.toISOString().split('T')[0];
}

function filtrarPorMetodo(metodo) {
    filtroMetodoAtual = filtroMetodoAtual === metodo ? null : metodo;
    atualizarListaServicosRecentes();
}

function voltarParaRegistro() {
    window.location.href = '/';
}

function fecharModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// Inicializar quando carregado
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Dashboard inicializado com sucesso!');
    inicializarDashboard();
    
    // Atualizar a cada 30 segundos
    setInterval(() => {
        atualizarDashboardCompleto();
    }, 30000);
});

// Sincronizar quando voltar online
window.addEventListener('online', () => {
    console.log('üåê Conex√£o restaurada, sincronizando...');
    carregarDados();
});

// Verificar vencimentos a cada hora
setInterval(() => {
    verificarVencimentosMensalistas();
}, 3600000);

// Inicializar verifica√ß√µes
verificarVencimentosMensalistas();
</script>
</body>
</html>